<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>npm library | https://zoubingwu.com</title><meta property=og:title content="npm library | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="How to distribute your npm library in a good way"><meta property=og:description content="How to distribute your npm library in a good way"><link rel=canonical href=https://zoubingwu.com/2023-05-19/npm-library><meta property=og:url content=https://zoubingwu.com/2023-05-19/npm-library><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2023-05-19T11:56:23.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="npm library | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><div class=content-container><div class=post><div class=post-title>npm library</div><span class=post-date><time>19 May 2023</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>js</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>npm</span></a></li></ul></div><p>2023 年了，在 npm 生态里如果你要写一个 library 并提供良好的 cjs/esm 支持，下面是一些值得注意的事情：</p><ul><li>首先可以使用 tsup 或者什么别的你喜欢的工具把你的源码编译成这两种格式，其他的什么 umd/iife 就随便你</li><li>如果你的包提供了多个入口的话还需要配置一下 package.json, 可能涉及到 main/module/exports 这些 property，<a href=https://nodejs.org/api/packages.html#package-entry-points>可以参见这里</a>，同时你还可以使用 <a href=https://publint.dev/ >publint</a> 和 <a href=https://arethetypeswrong.github.io/ >arethetypeswrong</a>，来进行检查，<a href=https://github.com/arethetypeswrong/arethetypeswrong.github.io/issues/15>社区甚至还造了一个 CLI 来使用</a></li><li>你的用户在使用的时候可能会碰上 TypeScript 的报错，<a href=https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-7.html#ecmascript-module-support-in-nodejs>因为 TypeScript Compiler 在 4.7 才开始提供 ESM 的支持</a>，他需要把 <code>module</code> 或者 <code>moduleResolution</code> 设置成 <code>node16</code> 或者 <code>nodenext</code></li><li>如果用户的 TypeScript 版本比较低，或者他不会设置怎么办呢，你可以学习 Next.js 的做法，根目录下写一堆 <code>entry1.js</code>, <code>entry1.d.ts</code>, 然后里面再指向到你的编译后的产物</li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></div></body></html>