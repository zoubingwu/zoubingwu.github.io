<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=stylesheet href=/assets/fonts/font-awesome.min.css type=text/css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>npm library | https://zoubingwu.com</title><meta property=og:title content="npm library | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="How to distribute your npm library in a good way"><meta property=og:description content="How to distribute your npm library in a good way"><link rel=canonical href=https://zoubingwu.com/2023-05-19/npm-library><meta property=og:url content=https://zoubingwu.com/2023-05-19/npm-library><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2023-05-19T11:56:23.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="npm library | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>npm library</div><span class=post-date><time>19 May 2023</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>js</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>npm</span></a></li></ul></div><p>It&#39;s 2023, and if you want to write a library in the npm ecosystem with good CommonJS (CJS) and ECMAScript Module (ESM) support, here are some things to consider:</p><ul><li>First, you can use tools like <a href=https://tsup.egoist.dev/ >tsup</a> or any other tool you prefer to compile your source code into these two formats. You can also choose any other formats like UMD or IIFE as well.</li><li>If your package provides multiple entry points, you&#39;ll need to configure your package.json accordingly. This may involve setting properties like <code>main</code>, <code>module</code>, and <code>exports</code>. You can refer to the official Node.js documentation on <a href=https://nodejs.org/api/packages.html#package-entry-points>package entry points</a>. Additionally, you can use tools like <a href=https://publint.dev/ >publint</a> and <a href=https://arethetypeswrong.github.io/ >arethetypeswrong</a> to perform checks. There&#39;s even a community-created CLI available for <a href=https://github.com/arethetypeswrong/arethetypeswrong.github.io/issues/15>arethetypeswrong</a>.</li><li>Your users may encounter TypeScript errors when using your library because TypeScript Compiler only started providing ESM support starting <a href=https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-7.html#ecmascript-module-support-in-nodejs>from version 4.7</a>. They need to set <code>module</code> or <code>moduleResolution</code> to <code>node16</code> or <code>nodenext</code>.</li><li>What if your users have a lower TypeScript version or don&#39;t know how to configure it? You can learn from the approach taken by <a href=https://github.com/vercel/next.js/tree/canary/packages/next>Next.js</a>. Create a bunch of files like <code>entry1.js</code>, <code>entry1.d.ts</code> in the root directory and have them point to your compiled artifacts.</li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>