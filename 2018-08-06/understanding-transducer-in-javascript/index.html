<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=stylesheet href=/assets/fonts/font-awesome.min.css type=text/css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>Understanding transducer in Javascript | https://zoubingwu.com</title><meta property=og:title content="Understanding transducer in Javascript | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="How do transducers work underneath the hood? This article explores transducers using JavaScript code examples."><meta property=og:description content="How do transducers work underneath the hood? This article explores transducers using JavaScript code examples."><link rel=canonical href=https://zoubingwu.com/2018-08-06/understanding-transducer-in-javascript><meta property=og:url content=https://zoubingwu.com/2018-08-06/understanding-transducer-in-javascript><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2018-08-06T16:53:31.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="Understanding transducer in Javascript | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>Understanding transducer in Javascript</div><span class=post-date><time>6 Aug 2018</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>javascript</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>functional programming</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>transducers</span></a></li></ul></div><h2 id=what-are-transducers>What are transducers?</h2><p>Transducer 是 transform 和 reducer 两个词的结合，熟悉 JavaScript 的同学都很了解 Array 的 reduce 方法了，我们有时候会需要遍历一个数组，将其变换结构后再 reduce 成最后需要的结果。</p><p>而 transducer 简单来说就是一种可组合的、不用生成中间变量的高效方式来达到上面的结果。</p><p>相比下面这样每一次的调用都会遍历后生成一个新的中间数组：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #E5C07B">array</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn1</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn2</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn3</span><span style="color: #ABB2BF">);</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// array1 =&gt; array2 =&gt; result</span></span></code></pre>
</code></pre><p>我们更希望的是省略中间的过渡结果，而直接得到最后的结果：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">transformation</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">compose</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn1</span><span style="color: #ABB2BF">), </span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn2</span><span style="color: #ABB2BF">), </span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn3</span><span style="color: #ABB2BF">));</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">transformation</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">array</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">//array1 =&gt; result</span></span></code></pre>
</code></pre><p>同时我们也可以在其他地方复用这个 transformation，或者将其与其他的方法组合。</p><h2 id=power-of-reduce>Power of reduce</h2><p>通常会组合 map 和 filter：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">filter</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>但其实这两者都可以用 reduce 来实现：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mapIncReducer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">};</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">mapIncReducer</span><span style="color: #ABB2BF">, []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span></code></pre>
</code></pre><p>其实可以把递加的逻辑抽取出来作为参数传入：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mapReducer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">f</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">f</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">));</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">};</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">mapReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></span></code></pre>
</code></pre><p>这样可以随意的传入各种各样的逻辑：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">mapReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8]</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">mapReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span></span></code></pre>
</code></pre><p>同样的 filter 也可以用 reduce 来实现：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filterReducer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">predicate</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #61AFEF">predicate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">)) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">};</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">filterReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>因此我们把一开始的例子改写成这样：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">mapReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">), [])</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">filterReducer</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>在这两个 reduce 里我们都使用了 push，实际上加减乘除和 push 等方法都是算作 reducing function，他们接受一个初始值和输入，然后 reduce 成一个单一的结果，如果了解 clojure 这样 lisp 风格的语言，他们的写法其实看上去都差不多：</p><pre><code class=language-clj><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">;;7</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">inc</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">;; 11</span></span></code></pre>
</code></pre><p>我们可以进一步把这些 reducing function 再抽出来：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">f</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">reducing</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reducing</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">f</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">));</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">predicate</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">reducing</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">predicate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reducing</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">;</span></span></code></pre>
</code></pre><p>然后像下面这样使用：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  }), [])</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  }), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>看到这里可能已经有点晕了，不过其实很简单，我们只是延迟执行，传入了两个函数在 reduce 的时候调用而已。reducer 总是符合这样的模式：<code>result, input -&gt; result</code>：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">})([], </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2]</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">})([</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 3]</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">})([</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 3, 4]</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">})([</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4]</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">})([</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">], </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6]</span></span></code></pre>
</code></pre><p>我们再回到上面 mapping 和 filtering：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">f</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">reducing</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reducing</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">f</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">));</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">predicate</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">reducing</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">predicate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reducing</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">result</span><span style="color: #ABB2BF">;</span></span></code></pre>
</code></pre><p>我们将其组合一下，也完全符合这种模式！</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)(</span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">))((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">});</span></span></code></pre>
</code></pre><p>因此我们用一个 reduce 就可以完成：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)(</span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">    })),</span></span>
<span class=line><span style="color: #ABB2BF">    []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>为了更好的可读性，我们用 Ramda 来改写一下：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">xform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">compose</span><span style="color: #ABB2BF">(</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">);</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]</span></span>
<span class=line><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">xform</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  }), []);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [2, 4, 6, 8, 10]</span></span></code></pre>
</code></pre><p>最后将其封装到一个 transduce function：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">transduce</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">xform</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reducing</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">initial</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">input</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">xform</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">reducing</span><span style="color: #ABB2BF">), </span><span style="color: #E06C75">initial</span><span style="color: #ABB2BF">);</span></span></code></pre>
</code></pre><p>就可以随意应用在更复杂的例子中而获得更高的效率：</p><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">square</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">xform</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">compose</span><span style="color: #ABB2BF">(</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">filtering</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">square</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mapping</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">));</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">transduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">xform</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">xs</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">xs</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">xs</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">}, [], [</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// [1, 5, 17, 37, 65]</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">transduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">xform</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">sum</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, [</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">6</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">]);</span></span>
<span class=line><span style="color: #7F848E; font-style: italic">// 30</span></span></code></pre>
</code></pre><h3 id=ref>ref</h3><ul><li><p><a href=http://elbenshira.com/blog/understanding-transducers/ >http://elbenshira.com/blog/understanding-transducers/</a></p></li><li><p><a href=http://blog.cognitect.com/blog/2014/8/6/transducers-are-coming>http://blog.cognitect.com/blog/2014/8/6/transducers-are-coming</a></p></li><li><p><a href=https://github.com/cognitect-labs/transducers-js>https://github.com/cognitect-labs/transducers-js</a></p></li><li><p><a href=https://medium.com/@roman01la/understanding-transducers-in-javascript-3500d3bd9624>https://medium.com/@roman01la/understanding-transducers-in-javascript-3500d3bd9624</a></p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>