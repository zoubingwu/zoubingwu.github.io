<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=stylesheet href=/assets/fonts/font-awesome.min.css type=text/css><link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,700;1,300;1,700&display=swap" rel=stylesheet><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>使用chrome开发者工具调试iOS webview | https://zoubingwu.com</title><meta property=og:title content="使用chrome开发者工具调试iOS webview | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="对于iOS开发时需要使用的webview调试通常只能使用safari，但是早已习惯了chrome强大的dev tool，该如何是好呢？"><meta property=og:description content="对于iOS开发时需要使用的webview调试通常只能使用safari，但是早已习惯了chrome强大的dev tool，该如何是好呢？"><link rel=canonical href=https://zoubingwu.com/2017-07-08/使用chrome开发者工具调试ios-webview><meta property=og:url content=https://zoubingwu.com/2017-07-08/使用chrome开发者工具调试ios-webview><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-07-08T20:15:27.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="使用chrome开发者工具调试iOS webview | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>使用chrome开发者工具调试iOS webview</div><span class=post-date><time>8 Jul 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>chrome</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>iOS</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>devtools</span></a></li></ul></div><h2 id=前言>前言</h2><p>一般情况下，如果要调试 iOS app中调用webview的表现，需要在 iOS 系统设置中为 Safari 开启 Web 检查器，并用 macOS 上的 Safari 开发者工具调试。但是早已习惯了强大的 Chrome DevTools 的我们，在使用 Safari 的开发者工具时，还是会有很多不习惯。 因此 Google 利用 Apple 的 <a href=https://developer.apple.com/technologies/safari/developer-tools.html>远程 Web 检查器服务</a> 制作了可以将 Chrome DevTools 的操作转为 Apple 远程 Web 检查器服务调用的协议和工具：<a href=https://github.com/google/ios-webkit-debug-proxy>iOS WebKit Debug Proxy（又称 iwdp）</a>。 下面就来简单介绍一下如何使用这个工具来让我们用 Chrome DevTools 调试 iOS Safari 页面。</p><h2 id=安装>安装</h2><p>首先我们通过<code>homebrew</code>来安装<a href=https://github.com/google/ios-webkit-debug-proxy>ios-webkit-debug-proxy</a>，可以通过查看github页面的文档和issues来详细了解使用方法。</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ brew update</span></span>
<span class=line><span style="color: #ABB2BF">$ brew install libimobiledevice</span></span>
<span class=line><span style="color: #ABB2BF">$ brew install ios-webkit-debug-proxy</span></span></code></pre>
</code></pre><h2 id=使用>使用</h2><p>可以使用真机，也可以使用模拟器，但是要注意的是必须先于代理启动。</p><p>通过命令行启动模拟器：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic"># Xcode changes these paths frequently, so doublecheck them</span></span>
<span class=line><span style="color: #ABB2BF">SDK_DIR=</span><span style="color: #98C379">&quot;/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs&quot;</span></span>
<span class=line><span style="color: #ABB2BF">SIM_APP=</span><span style="color: #98C379">&quot;/Applications/Xcode.app/Contents/Developer/Applications/Simulator.app/Contents/MacOS/Simulator&quot;</span></span>
<span class=line><span style="color: #E06C75">$SIM_APP</span><span style="color: #ABB2BF"> -SimulateApplication </span><span style="color: #E06C75">$SDK_DIR</span><span style="color: #ABB2BF">/iPhoneSimulator8.4.sdk/Applications/MobileSafari.app/MobileSafari</span></span></code></pre>
</code></pre><p>如果是真机的话需要在设置 - Safari - 高级中，打开web检查器。</p><h5 id=开启代理>开启代理</h5><p>用 <code>-f</code> 可以选择指定的 DevTools UI 介面，这个介面可以是任意的，这里我们用 Chrome 自带的开发者工具：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy -f chrome-devtools://devtools/bundled/inspector.html</span></span>
<span class=line><span style="color: #ABB2BF">Listing devices on :9221</span></span>
<span class=line><span style="color: #ABB2BF">Connected :9222 to xxxx (xxxxxxxxxxxxxxxxx)</span></span></code></pre>
</code></pre><p>打开 <a href=http://localhost:9221/ >http://localhost:9221/</a>，然后点击对应的链接，之后按上头的英文指示复制链接到新tab打开就可以了：</p><pre><code><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #abb2bf">Note: Your browser may block1,2 the above links with JavaScript console error:
  Not allowed to load local resource: chrome-devtools://...
To open a link: right-click on the link (control-click on Mac), &#39;Copy Link Address&#39;, and paste it into address bar.</span></span></code></pre>
</code></pre><p><strong>注意：因为 Chrome 不允许打开 chrome-devtools:// 协议的链接，所以不能直接点击链接</strong></p><h2 id=错误处理>错误处理</h2><p>问题 1：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy</span></span>
<span class=line><span style="color: #ABB2BF">Listing devices on :9221  </span></span>
<span class=line><span style="color: #ABB2BF">Could not connect to lockdownd. Exiting.: Permission deniedConnected :9222 to SIMULATOR (SIMULATOR)  </span></span>
<span class=line><span style="color: #ABB2BF">Invalid message _rpc_reportConnectedDriverList: &lt;dict&gt;  </span></span>
<span class=line><span style="color: #ABB2BF">    &lt;key&gt;WIRDriverDictionaryKey&lt;/key&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    &lt;dict&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    &lt;/dict&gt;</span></span>
<span class=line><span style="color: #ABB2BF">&lt;/dict&gt;  </span></span></code></pre>
</code></pre><p>解决方式：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">sudo chmod +x /var/db/lockdown  </span></span></code></pre>
</code></pre><p>问题 2：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy</span></span>
<span class=line><span style="color: #ABB2BF">Listing devices on :9221  </span></span>
<span class=line><span style="color: #ABB2BF">Connected :9222 to SIMULATOR (SIMULATOR)  </span></span>
<span class=line><span style="color: #ABB2BF">Invalid message _rpc_reportConnectedDriverList: &lt;dict&gt;  </span></span>
<span class=line><span style="color: #ABB2BF">    &lt;key&gt;WIRDriverDictionaryKey&lt;/key&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    &lt;dict&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    &lt;/dict&gt;</span></span>
<span class=line><span style="color: #ABB2BF">&lt;/dict&gt;  </span></span>
<span class=line><span style="color: #ABB2BF">Disconnected :9222 from SIMULATOR (SIMULATOR)  </span></span>
<span class=line><span style="color: #ABB2BF">send failed: Socket is not connected  </span></span></code></pre>
</code></pre><p>解决方式，重装依赖工具：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ brew uninstall --force ignore-dependencies -libimobiledevice ios-webkit-debug-proxy</span></span>
<span class=line><span style="color: #ABB2BF">$ brew install libimobiledevice ios-webkit-debug-proxy</span></span></code></pre>
</code></pre><p>问题3：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy</span></span>
<span class=line><span style="color: #ABB2BF">Listing devices on :9221  </span></span>
<span class=line><span style="color: #ABB2BF">Connected :9222 to SIMULATOR (SIMULATOR)  </span></span>
<span class=line><span style="color: #ABB2BF">send failed: Socket is not connected  </span></span>
<span class=line><span style="color: #ABB2BF">recv failed: Operation timed out  </span></span></code></pre>
</code></pre><p>解决方式，指定 UI 介面：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy -f chrome-devtools://devtools/bundled/inspector.html</span></span></code></pre>
</code></pre><p>问题4：</p><p>连接 iOS 10 设备可能会出以下报错，无法连接设备：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ ios_webkit_debug_proxy -f chrome-devtools://devtools/bundled/inspector.html</span></span>
<span class=line><span style="color: #ABB2BF">Listing devices on :9221  </span></span>
<span class=line><span style="color: #ABB2BF">Could not connect to lockdownd. Exiting.: Broken pipe  </span></span>
<span class=line><span style="color: #ABB2BF">Unable to attach &lt;id&gt; inspector  </span></span></code></pre>
</code></pre><p>更新最新的 libimobiledevice 即可：</p><pre><code class=language-bash><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">$ brew upgrade libimobiledevice --HEAD</span></span></code></pre>
</code></pre><h3 id=ref>ref</h3><ul><li><p><a href=https://sebastianblade.com/debug-ios-safari-with-chrome-devtools/ >如何用 Chrome DevTools 调试 iOS Safari</a></p></li><li><p><a href=https://github.com/google/ios-webkit-debug-proxy>google/ios-webkit-debug-proxy</a></p></li><li><p><a href=https://github.com/google/ios-webkit-debug-proxy/issues/160>Could not connect to lockdownd. Exiting Permission denied #160</a></p></li><li><p><a href=https://github.com/google/ios-webkit-debug-proxy/issues/19>send failed: Socket is not connected #19</a></p></li><li><p><a href=https://github.com/google/ios-webkit-debug-proxy/issues/168>could not connect to lockdownd. Exiting.: Permission denied #168</a></p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>