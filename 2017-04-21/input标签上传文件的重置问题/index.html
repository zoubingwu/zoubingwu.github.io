<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>input标签上传文件的重置问题 | https://zoubingwu.com</title><meta property=og:title content="input标签上传文件的重置问题 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=记录关于input上传文件的一个小坑...><meta property=og:description content=记录关于input上传文件的一个小坑...><link rel=canonical href=https://zoubingwu.com/2017-04-21/input标签上传文件的重置问题><meta property=og:url content=https://zoubingwu.com/2017-04-21/input标签上传文件的重置问题><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-04-21T16:46:18.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="input标签上传文件的重置问题 | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>input标签上传文件的重置问题</div><span class=post-date><time>21 Apr 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>html</span></a></li></ul></div><p>因为最近需要做一个功能，使用input上传图片，成功后为图片右上角添加一个删除的按钮，点击按钮则将图片去除并把input内容置空，这个过程中还有一点小坑。</p><p>因为是在vue的框架中，因此用一个变量来保存图片的地址，而按钮的显示就根据这个图片地址是否为空字符串来显示，点击删除就直接把这个变量赋值为空字符串就好了。但是需要注意的是清空的input的这个步骤，网络上有不少方法都会引起input标签上绑定事件的丢失，这样下一次上传图片的时候就无法触发change事件了。</p><p>总结了一下常用的方法有三种：</p><ol><li>设置input的value为空，实际上因为类型为file的input标签的value值并不想文本输入框一样是可以随便设置的，因为安全性的问题这个value实际上是只读的，但是IE11+以上以及chrome等比较新的浏览器是可以把这个value设置为空的。</li><li>创建一个新的input标签，来取代之前的。这种方式就会丢失绑定的事件和一些扩展的属性了。</li><li>通过form.reset()方法来重置表单。对于没有使用表单提交而是ajax提交，或者为了不影响同一表单内其他的表单控件，可以创建一个form元素，用这个form元素来包裹住目标input，从而实现重置。</li></ol><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">clearInputFile</span><span style="color: #24292E">(</span><span style="color: #E36209">f</span><span style="color: #24292E">){</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E">(f.value){</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">try</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">      f.value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&#39;</span><span style="color: #24292E">; </span><span style="color: #6A737D">//IE11, latest Chrome/Firefox/Opera...</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">catch</span><span style="color: #24292E">(err) { }</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E">(f.value){ </span><span style="color: #6A737D">//IE5 ~ IE10</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">var</span><span style="color: #24292E"> form </span><span style="color: #D73A49">=</span><span style="color: #24292E"> document.</span><span style="color: #6F42C1">createElement</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;form&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">var</span><span style="color: #24292E"> parentNode </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f.parentNode;</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">var</span><span style="color: #24292E"> ref </span><span style="color: #D73A49">=</span><span style="color: #24292E"> f.nextSibling;</span></span>
<span class=line><span style="color: #24292E">      form.</span><span style="color: #6F42C1">appendChild</span><span style="color: #24292E">(f);</span></span>
<span class=line><span style="color: #24292E">      form.</span><span style="color: #6F42C1">reset</span><span style="color: #24292E">();</span></span>
<span class=line><span style="color: #24292E">      parentNode.</span><span style="color: #6F42C1">insertBefore</span><span style="color: #24292E">(f,ref);</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">clearInputFile</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">f</span><span style="color: #C9D1D9">){</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">(f.value){</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">try</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">      f.value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;&#39;</span><span style="color: #C9D1D9">; </span><span style="color: #8B949E">//IE11, latest Chrome/Firefox/Opera...</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">catch</span><span style="color: #C9D1D9">(err) { }</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">(f.value){ </span><span style="color: #8B949E">//IE5 ~ IE10</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> form </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;form&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> parentNode </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> f.parentNode;</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> ref </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> f.nextSibling;</span></span>
<span class=line><span style="color: #C9D1D9">      form.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(f);</span></span>
<span class=line><span style="color: #C9D1D9">      form.</span><span style="color: #D2A8FF">reset</span><span style="color: #C9D1D9">();</span></span>
<span class=line><span style="color: #C9D1D9">      parentNode.</span><span style="color: #D2A8FF">insertBefore</span><span style="color: #C9D1D9">(f,ref);</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>