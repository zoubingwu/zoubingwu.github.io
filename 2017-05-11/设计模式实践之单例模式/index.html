<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>设计模式实践之单例模式 | https://zoubingwu.com</title><meta property=og:title content="设计模式实践之单例模式 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=最近因为翻译Vue-ssr文档的原因，其中涉及到了在Node服务端渲染时，不能采取单例模式，这篇文章就稍微说说单例模式...><meta property=og:description content=最近因为翻译Vue-ssr文档的原因，其中涉及到了在Node服务端渲染时，不能采取单例模式，这篇文章就稍微说说单例模式...><link rel=canonical href=https://zoubingwu.com/2017-05-11/设计模式实践之单例模式><meta property=og:url content=https://zoubingwu.com/2017-05-11/设计模式实践之单例模式><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-05-11T16:46:18.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="设计模式实践之单例模式 | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>设计模式实践之单例模式</div><span class=post-date><time>11 May 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>patterns</span></a></li></ul></div><p>最近因为翻译Vue-ssr文档的原因，其中涉及到了在Node服务端渲染时，不能采取单例模式，需要暴露一个工厂函数使得对于每一个请求都返回一个全新的vue实例，否则会因为状态共享的特性，而引起跨请求的状态污染。这篇文章就说说非常常见的单例模式。</p><p>单例模式的定义是很简单的：保证一个类只有一个实例，并且提供一个访问它的全局访问点。</p><p>在Javascript中单例模式的用途是很广泛的，很多时候一个对象我们往往只需要一个，比如浏览器中的window对象，比如页面中只需要一个登录悬浮窗等等。</p><p>实现单例模式是很简单的，只需要用一个变量来标识当前是否已经为这个类创建过实例就可以了，如果有的话直接返回之前的实例：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">name</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">.name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> name;</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">.instance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span><span style="color: #24292E">;</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #005CC5">Singleton</span><span style="color: #24292E">.</span><span style="color: #005CC5">prototype</span><span style="color: #24292E">.</span><span style="color: #6F42C1">getName</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">.name);</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line><span style="color: #24292E">Singleton.</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">name</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #005CC5">this</span><span style="color: #24292E">.instance) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.instance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Singleton</span><span style="color: #24292E">(name);</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.instance;</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Singleton.</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Singleton.</span><span style="color: #6F42C1">getInstance</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;b&#39;</span><span style="color: #24292E">);</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(a </span><span style="color: #D73A49">===</span><span style="color: #24292E"> b); </span><span style="color: #6A737D">// true</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Singleton</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">name</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> name;</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">;</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #79C0FF">Singleton</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">getName</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.name);</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line><span style="color: #C9D1D9">Singleton.</span><span style="color: #D2A8FF">getInstance</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">name</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.instance) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Singleton</span><span style="color: #C9D1D9">(name);</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.instance;</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> Singleton.</span><span style="color: #D2A8FF">getInstance</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;a&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> Singleton.</span><span style="color: #D2A8FF">getInstance</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;b&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(a </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> b); </span><span style="color: #8B949E">// true</span></span></code></pre></div>
</code></pre><p>可以看到这个方式有一个问题，就是我们没有直接使用常用的<code>new</code>关键字来获取实例，而是使用<code>getInstance</code>方法，那么对于一个我们无法确定是不是单例模式的构造函数呢，这就增加了这个类的不透明性。</p><p>现在我们假设需要创建一个页面中唯一的div节点，代码如下：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> OnlyDiv </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> instance;</span></span>
<span class=line><span style="color: #24292E">  </span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnlyDiv</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">html</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (instance) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> instance;</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.html </span><span style="color: #D73A49">=</span><span style="color: #24292E"> html;</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">init</span><span style="color: #24292E">();</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> instance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #005CC5">OnlyDiv</span><span style="color: #24292E">.</span><span style="color: #005CC5">prototype</span><span style="color: #24292E">.</span><span style="color: #6F42C1">init</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> div </span><span style="color: #D73A49">=</span><span style="color: #24292E"> document.</span><span style="color: #6F42C1">createElement</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;div&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">    div.innerHTML </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.html;</span></span>
<span class=line><span style="color: #24292E">    document.body.</span><span style="color: #6F42C1">appendChild</span><span style="color: #24292E">(div);</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> OnlyDiv;</span></span>
<span class=line><span style="color: #24292E">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnlyDiv</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnlyDiv</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;b&#39;</span><span style="color: #24292E">);</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(a </span><span style="color: #D73A49">===</span><span style="color: #24292E"> b) </span><span style="color: #6A737D">// true</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> OnlyDiv </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> instance;</span></span>
<span class=line><span style="color: #C9D1D9">  </span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">OnlyDiv</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">html</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (instance) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> instance;</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.html </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> html;</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">;</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">OnlyDiv</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> div </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;div&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">    div.innerHTML </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.html;</span></span>
<span class=line><span style="color: #C9D1D9">    document.body.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(div);</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> OnlyDiv;</span></span>
<span class=line><span style="color: #C9D1D9">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">OnlyDiv</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;a&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">OnlyDiv</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;b&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(a </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> b) </span><span style="color: #8B949E">// true</span></span></code></pre></div>
</code></pre><p>这里我们使用IIFE(<a href=http://benalman.com/news/2010/11/immediately-invoked-function-expression/#iife>Immediately-Invoked Function Expression</a>)和闭包来封装，并且匿名函数返回了真正的构造函数，可以直接使用<code>new</code>关键字来实例化，但是稍微增加了程序的复杂度，也有点难以阅读。另外整个函数把构造div和确保只有单例这两处逻辑耦合在一起，以后要修改的话也有点麻烦，继续优化的话我们可以把这两部分分开来：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnlyDiv</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">html</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">.html </span><span style="color: #D73A49">=</span><span style="color: #24292E"> html;</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #005CC5">this</span><span style="color: #24292E">.</span><span style="color: #6F42C1">init</span><span style="color: #24292E">();</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #005CC5">OnlyDiv</span><span style="color: #24292E">.</span><span style="color: #005CC5">prototype</span><span style="color: #24292E">.</span><span style="color: #6F42C1">init</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> div </span><span style="color: #D73A49">=</span><span style="color: #24292E"> document.</span><span style="color: #6F42C1">createElement</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;div&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">  div.innerHTML </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">.html;</span></span>
<span class=line><span style="color: #24292E">  document.body.</span><span style="color: #6F42C1">appendChild</span><span style="color: #24292E">(div);</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// 引入一个代理</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> ProxyOnlyDiv </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> instance;</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">html</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #D73A49">!</span><span style="color: #24292E">instance) {</span></span>
<span class=line><span style="color: #24292E">      instance </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnlyDiv</span><span style="color: #24292E">(html);</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> instance;</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ProxyOnlyDiv</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> b </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ProxyOnlyDiv</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;b&#39;</span><span style="color: #24292E">);</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(a </span><span style="color: #D73A49">===</span><span style="color: #24292E"> b) </span><span style="color: #6A737D">// true;</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">OnlyDiv</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">html</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.html </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> html;</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #79C0FF">OnlyDiv</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> div </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">createElement</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;div&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">  div.innerHTML </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.html;</span></span>
<span class=line><span style="color: #C9D1D9">  document.body.</span><span style="color: #D2A8FF">appendChild</span><span style="color: #C9D1D9">(div);</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// 引入一个代理</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> ProxyOnlyDiv </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> instance;</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">html</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">instance) {</span></span>
<span class=line><span style="color: #C9D1D9">      instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">OnlyDiv</span><span style="color: #C9D1D9">(html);</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> instance;</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ProxyOnlyDiv</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;a&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ProxyOnlyDiv</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;b&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(a </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> b) </span><span style="color: #8B949E">// true;</span></span></code></pre></div>
</code></pre><p>这样以来，我们把两种不同的逻辑完全分开来，两者组合就达到了单例模式的效果。以上，其实都是传统的面向对象的实现，以类为中心，但是对于js来说其实是没有类这一概念的，ES6的class其实也只是语法糖，既然我们只需要一个唯一的对象，全局对象其实就经常被我们当成单例来使用：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> a </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {};</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {};</span></span></code></pre></div>
</code></pre><p>当然全局对象由于污染命名的问题并不鼓励使用，我们可以适当使用命名空间或者闭包来封装私有变量：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// 使用命名空间减少全局变量的数目</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> namespace </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6F42C1">a</span><span style="color: #24292E">: </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;a&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">  },</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6F42C1">b</span><span style="color: #24292E">: </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;b&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">  },</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// 把变量封装在闭包内部，只暴露固定接口,这样也减少了对全局的污染</span></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> user </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">function</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> _name </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;trump&#39;</span><span style="color: #24292E">;</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> _age </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">70</span><span style="color: #24292E">;</span></span>
<span class=line><span style="color: #24292E">  </span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #6F42C1">getUserInfo</span><span style="color: #24292E">: </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">      console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(_name </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39; is &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> _age </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39; years old.&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">user.</span><span style="color: #6F42C1">getUserInfo</span><span style="color: #24292E">(); </span><span style="color: #6A737D">// trump is 70 years old.</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// 使用命名空间减少全局变量的数目</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> namespace </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">a</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;a&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">  },</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">b</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;b&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">  },</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// 把变量封装在闭包内部，只暴露固定接口,这样也减少了对全局的污染</span></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> user </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> _name </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;trump&#39;</span><span style="color: #C9D1D9">;</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> _age </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">70</span><span style="color: #C9D1D9">;</span></span>
<span class=line><span style="color: #C9D1D9">  </span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">getUserInfo</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">      console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(_name </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; is &#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> _age </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; years old.&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">})();</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">user.</span><span style="color: #D2A8FF">getUserInfo</span><span style="color: #C9D1D9">(); </span><span style="color: #8B949E">// trump is 70 years old.</span></span></code></pre></div>
</code></pre></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>