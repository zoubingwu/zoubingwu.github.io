<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=preload href=/assets/fonts/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>javascript简单实现跨浏览器复制粘贴 | https://zoubingwu.com</title><meta property=og:title content="javascript简单实现跨浏览器复制粘贴 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=""><meta property=og:description content=""><link rel=canonical href=https://zoubingwu.com/2017-03-31/javascript简单实现跨浏览器复制粘贴><meta property=og:url content=https://zoubingwu.com/2017-03-31/javascript简单实现跨浏览器复制粘贴><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-03-31T21:46:18.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="javascript简单实现跨浏览器复制粘贴 | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>javascript简单实现跨浏览器复制粘贴</div><span class=post-date><time>31 Mar 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>javascript</span></a></li></ul></div><p>最近写一个小功能，需要点击按钮来把内容复制到剪贴板，虽然有不少插件可以很轻易的实现，不过其实用短短的几行原生js就足够了，代码不需要任何的依赖。</p><p>首先要了解的是<code>clipboard</code>的相关api，由于这个标准一直在草稿阶段，加上浏览器对权限的限制不一，因此兼容性并不是很好。</p><p>文档可以看这里：<a href=https://w3c.github.io/clipboard-apis/#widl-ClipboardEvent-clipboardData>https://w3c.github.io/clipboard-apis/#widl-ClipboardEvent-clipboardData</a></p><p>具体的浏览器支持和详细的细节可以看这里：<a href="http://caniuse.com/#search=clipboard">http://caniuse.com/#search=clipboard</a></p><p>在IE中可以通过getData和setData两个方法就可以实现复制和粘贴了：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">copy</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">clipboardData</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">     </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">clipBoard</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setData</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Text&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">innerHTML</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">paste</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">clipboardData</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">innerText</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">clipboardData</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">getData</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Text&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><p>有一个更好的方法，是使用<code>document.execCommand(‘copy’)</code>来执行复制操作，当然首先你需要先手动来选中需要复制的文本：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">copy</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">){</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">();</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">execCommand</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;copy&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><p>对于chrome和火狐，因为上面的copy操作必须针对于可修改的目标，因此我们可以稍作修改：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">copy</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">textArea</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">createElement</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;textarea&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 由于火狐需要目标必须可见，因此我们可以设置透明度为0</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">textArea</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">setAttribute</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;style&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;width:1px;border:0;opacity:0;&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">appendChild</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">textArea</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">textArea</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">innerHTML</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">textArea</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">();</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">execCommand</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;copy&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">document</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">body</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">removeChild</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">textArea</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>