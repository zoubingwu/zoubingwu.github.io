<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=stylesheet href=/assets/fonts/font-awesome.min.css type=text/css><link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,700;1,300;1,700&display=swap" rel=stylesheet><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>利用通用链接从web端引流到iOS app | https://zoubingwu.com</title><meta property=og:title content="利用通用链接从web端引流到iOS app | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="在web端通过url scheme和universal link来呼出iOS app或跳转到app store，实现对app的引流。"><meta property=og:description content="在web端通过url scheme和universal link来呼出iOS app或跳转到app store，实现对app的引流。"><link rel=canonical href=https://zoubingwu.com/2017-06-15/利用通用链接从web端引流到ios-app><meta property=og:url content=https://zoubingwu.com/2017-06-15/利用通用链接从web端引流到ios-app><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-06-15T10:15:27.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="利用通用链接从web端引流到iOS app | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>利用通用链接从web端引流到iOS app</div><span class=post-date><time>15 Jun 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>iOS</span></a></li></ul></div><p>经常会有在app上线后，web端需要添加将用户引导到app的入口，这里只说说iOS端的处理，其实安卓的话区别也不大。</p><h4 id=入口>入口</h4><p>通常从web端引流到app有两处入口，一个是浏览器顶部的banner：</p><p>![smartbanner](/assets/images/2017-06-15-利用通用链接从web端引流到iOS app/smartbanner_2x.png)</p><p>一个是底部可以随滚动控制显示和隐藏的悬浮按钮。</p><p>关于顶部的banner，一个是将iOS开发人员编写的通用链接的<code>apple-app-site-association</code>文件置于服务器的根目录（同网页端的文件），另一种就是在head内加入meta标签：</p><pre><code class=language-html><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">meta</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;apple-itunes-app&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">content</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL&quot;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre>
</code></pre><p>相关的内容可以参考苹果的<a href=https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/PromotingAppswithAppBanners/PromotingAppswithAppBanners.html>官方文档</a>。</p><h4 id=逻辑和代码>逻辑和代码</h4><p>在点击这两个入口的时候需要判断两种情况：</p><ol><li>如果用户安装了app，则跳转到app内相对应的页面。</li><li>如果用户没有安装app，则跳转到app store对应的下载页面。</li></ol><p>顶部的banner由于是苹果系统所提供的，可以自动判断，就不再赘述。</p><p>仅通过浏览器并没有API去判断用户是否安装了app，所以在这里引入两个概念，一个是<code>URL Scheme</code>，一个是通用链接<code>Universal Link</code>。，由于是iOS开发的内容，所以关于这两者的具体使用和配置可以查看相关的文档，不在这里详细解释了。</p><p><code>URL Scheme</code>简单来说，类似我们web端熟悉的通常使用<code>http</code>或<code>https</code>协议的URL，比如：</p><pre><code class=language-xml><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">首页：https://www.apple.com</span></span>
<span class=line><span style="color: #ABB2BF">子页面：https://www.apple.com/mac</span></span></code></pre>
</code></pre><p>而<code>URL Scheme</code>可以理解为使用了应用特有的协议，它们长的类似这样：</p><pre><code class=language-xml><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">应用首页：weixin://</span></span>
<span class=line><span style="color: #ABB2BF">子页面： weixin://di/moments (朋友圈)</span></span></code></pre>
</code></pre><p>在app端进行了相关的配置以后，网页端通过<code>user agent</code>来检测到iOS环境下时，可以直接设置：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">href</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">url</span></span></code></pre>
</code></pre><p>此时如果安装了应用，就会直接跳转到app，否则会弹框提醒无法识别这个链接，因此此处的体验不是特别好。</p><p>而通用链接其实就是一条https链接，app内配置后使用时如果安装了app则会直接跳转到app，否则会当成普通的网页链接跳转，注意需要配置https，并且使用时需要和当前页面异域。</p><p>因此我们可以将这条链接制作为一个中转的欢迎页面，比如通用链接为<code>https://ios.xxx.com</code>，在<code>https://xxx.com</code>下的悬浮按钮上绑定点击事件，点击后直接设置<code>location.href</code>为<code>https://ios.xxx.com</code>，那么安装了app就可以直接跳转到app，否则跳转到中转页面，在中转页面我们可以在载入后马上设置<code>location.href</code>为iTunes的链接，那么用户进入中转页面后马上会提示是否跳转到iTunes的对应app下载链接。同样的，通过在链接中带上参数就可以确保跳转到对应的子页面。</p><p>由于通用链接仅支持iOS9以上的用户，因此对于iOS9以下的用户我们还是只能使用<code>URL Scheme</code>，下面是代码：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">openInApp</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// iOS9以上直接使用通用链接</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">version</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&gt;=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">9</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">href</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;https://ios.xxx.com?parameter=xxxx&#39;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">//iOS9以下，使用URL Scheme</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">href</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;app://xxxxxxxx&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 设置一个计时器，若安装了app则上一步就成功跳转，以下代码不会执行，</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 若未安装则无法识别上一个抛出的链接，我们则继续抛出app在iTune的下载地址</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">loadDateTime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Date</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">now</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">setTimeout</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">timeOutDateTime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Date</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">now</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">timeOutDateTime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">loadDateTime</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">location</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">href</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;https://itunes.apple.com/xxxxxxxxxx&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line><span style="color: #ABB2BF">  }, </span><span style="color: #D19A66">25</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><p>最后值得注意的是，使用通用链接跳转到app后，iOS在左上角提供了一个返回到浏览器的点击链接，也会在右上角提供一个使用浏览器打开通用链接的入口，点击后会在浏览器创建一个新的窗口来打开通用链接，意味着打开了我们为未安装app的用户准备的中转页面。并且这个使用习惯会被系统记录，一旦使用了一次，则以后每次点击通用链接都会使用浏览器来打开而无视是否安装了app，除非再次手动使用app打开来改变这个纪录。</p></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>