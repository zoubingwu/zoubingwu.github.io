<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>创建对象的几种模式（二） | https://zoubingwu.com</title><meta property=og:title content="创建对象的几种模式（二） | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=""><meta property=og:description content=""><link rel=canonical href=https://zoubingwu.com/2017-01-04/创建对象的几种模式（二）><meta property=og:url content=https://zoubingwu.com/2017-01-04/创建对象的几种模式（二）><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-01-04T20:22:18.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="创建对象的几种模式（二） | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>创建对象的几种模式（二）</div><span class=post-date><time>4 Jan 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>javascript</span></a></li></ul></div><ul><li><h4 id=原型模式>原型模式</h4><p>我们创建的每一个函数，都有一个<code>prototype</code>属性，指向一个对象，而这个对象的用途就是包涵所有可以被实例继承的方法和属性，也就是说，不必在构造函数中定义对象实例的信息，我们可以把那些不变的属性和方法，直接添加到原型对象中，如下面这个例子：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">name</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">age</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">job</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">age</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">job</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">prototype</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sayName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;nicolas&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">29</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;software engineer&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">person2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;greg&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">27</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;doctor&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class=line></span>
<span class=line><span style="color: #E5C07B">person1</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sayName</span><span style="color: #ABB2BF">() ; </span><span style="color: #7F848E; font-style: italic">// &quot;nicolas&quot;</span></span>
<span class=line><span style="color: #E5C07B">person2</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">sayName</span><span style="color: #ABB2BF">(); </span><span style="color: #7F848E; font-style: italic">// &quot;greg&quot;</span></span>
<span class=line></span>
<span class=line><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">person1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">sayName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person2</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">sayName</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// true</span></span></code></pre>
</code></pre><p>这里我们可以看到两个实例访问的都是同一个sayName函数，他们共享了原型对象上的这一方法。要完全理解原型模式的工作原理，我们就需要先理解ECMAScript中原型对象的性质。下面总结一些关键点：</p><ol><li><p>任何时候创建一个函数，这个函数都会自动获得一个<code>prototype</code>属性，这个属性指向了了函数的原型对象，同时所有的原型对象都会包含一个<code>constructor</code>属性，指向了这个<code>prototype</code>属性所在的函数。根据前面的例子来说，也就是<code>Person.prototype.constructor</code>指向了<code>Person</code>。</p></li><li><p>这个原型对象默认是只获得<code>constructor</code>属性的，而其他方法，则是从Object继承而来。在浏览器脚本中，并没有标准的方式来访问<code>prototype</code>，但是Firefix、Safari、Chrome在每个对象上都支持一个属性<code>_proto_</code>来访问。</p></li><li><p>在我们调用<code>sayName</code>方法时，虽然<code>person1</code>实例上并没有这个方法，但是会从实例开始按照原型链往上搜索，因此我们如果在实例中添加一个属性，这个属性与原型中的一个属性同名，那么这个属性就会屏蔽原型中那个属性，因为代码执行时，发现实例上已经有了这个属性，就会停止往上搜索。因此只要创建了这个属性，哪怕再次把该属性设置为<code>null</code>，也依然无法恢复，不过可以使用<code>delete</code>操作符来删除该属性，从而重新访问原型中的同名属性。</p></li><li><p>关于实例中的属性还是原型中的属性的检测。<code>in</code>操作符是只要通过对象能访问到就返回<code>true</code>，而<code>hasOwnProperty()</code>只有属性存在于实例上时才返回<code>true</code>，在<code>for-in</code>循环中，返回的是所有能够通过对象访问，而且可枚举（enumerable）的属性。要获得所有可枚举的实例属性，可以使用ECMAScript5中的<code>Object.keys()</code>方法。</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">var</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">keys</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">keys</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">Person</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">keys</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">//&quot;name,age,job&quot;</span></span></code></pre>
</code></pre></li></ol><p>注意到我们每次为原型对象添加一个属性或方法就要敲一遍<code>Person.prototype</code>，因此为了减少不必要的输入，更常见的是直接用对象字面量来重写整个原型对象：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">() {};</span></span>
<span class=line></span>
<span class=line><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">prototype</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&quot;nicolas&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">29</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;software engineer&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">sayName</span><span style="color: #ABB2BF">: </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">(){</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><p>但是有一点要注意，<code>constructor</code>属性不再指向Person了，因为我们重新创建了一个新的原型对象，因此需要手动指定：</p><pre><code class=language-javascript><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Person</span><span style="color: #ABB2BF">() {};</span></span>
<span class=line></span>
<span class=line><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">prototype</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">constructor</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Person</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&quot;nicolas&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">29</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;software engineer&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">sayName</span><span style="color: #ABB2BF">: </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF">(){</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><p>当然这样直接设置会导致该属性是可以枚举的，因为默认参数enumerable会设置为true，你也可以使用Object.defineProperty()来设置。</p><p>​</p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>