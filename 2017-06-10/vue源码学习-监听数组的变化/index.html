<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>Vue源码学习-监听数组的变化 | https://zoubingwu.com</title><meta property=og:title content="Vue源码学习-监听数组的变化 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=关于vue的数据监听如何监听数组的变化...><meta property=og:description content=关于vue的数据监听如何监听数组的变化...><link rel=canonical href=https://zoubingwu.com/2017-06-10/vue源码学习-监听数组的变化><meta property=og:url content=https://zoubingwu.com/2017-06-10/vue源码学习-监听数组的变化><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-06-10T11:15:27.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="Vue源码学习-监听数组的变化 | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>Vue源码学习-监听数组的变化</div><span class=post-date><time>10 Jun 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>vue</span></a></li></ul></div><p>监听数组的变化比起监听对象的属性变化麻烦了不少，因为在JS里数组这一数据结构的有着很多的修改方法，既可以通过<code>push</code>,<code>pop</code>,<code>shift</code>等原生的方法来修改，也可以直接通过指定下标来直接赋值。官方文档的说明中，直接指出了Vue是通过包装了多种数组操作方法来实现的，因此如果直接指定下标来设置元素，或者通过长度来修改数组都是无法实现触发视图的更新的。</p><p>值得注意的是，所谓的包装数组的方法只是针对的声明的数据数组，即Vue实例中的data()函数中所拥有的，并非原生的Array对象中的方法，这也是为了尽量避免对全局造成影响。</p><p>这里以常见的几个方法为例子：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">methods</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #032F62">&#39;push&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;pop&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;shift&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;unshift&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;splice&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;sort&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;reverse&#39;</span><span style="color: #24292E">];</span></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">arrWrapper</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [];</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">methods.</span><span style="color: #6F42C1">forEach</span><span style="color: #24292E">(</span><span style="color: #E36209">method</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">  arrWrapper[method] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;data has been changed&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">Array</span><span style="color: #24292E">.</span><span style="color: #005CC5">prototype</span><span style="color: #24292E">[method].</span><span style="color: #6F42C1">apply</span><span style="color: #24292E">(</span><span style="color: #005CC5">this</span><span style="color: #24292E">, </span><span style="color: #005CC5">arguments</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">})</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> list </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #005CC5">3</span><span style="color: #24292E">, </span><span style="color: #005CC5">4</span><span style="color: #24292E">];</span></span>
<span class=line><span style="color: #24292E">list.</span><span style="color: #005CC5">__proto__</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> arrWrapper;</span></span>
<span class=line><span style="color: #24292E">list.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">);</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">methods</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [</span><span style="color: #A5D6FF">&#39;push&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;pop&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;shift&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;unshift&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;splice&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;sort&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;reverse&#39;</span><span style="color: #C9D1D9">];</span></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">arrWrapper</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">methods.</span><span style="color: #D2A8FF">forEach</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">method</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">  arrWrapper[method] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;data has been changed&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Array</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">prototype</span><span style="color: #C9D1D9">[method].</span><span style="color: #D2A8FF">apply</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">arguments</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">})</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> list </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [</span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">];</span></span>
<span class=line><span style="color: #C9D1D9">list.</span><span style="color: #79C0FF">__proto__</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> arrWrapper;</span></span>
<span class=line><span style="color: #C9D1D9">list.</span><span style="color: #D2A8FF">push</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">5</span><span style="color: #C9D1D9">);</span></span></code></pre></div>
</code></pre><p>这样就基本完成了对数组方法的包装。</p></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>