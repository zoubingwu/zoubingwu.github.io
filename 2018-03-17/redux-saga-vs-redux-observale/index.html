<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>Redux-saga vs Redux-observale | https://zoubingwu.com</title><meta property=og:title content="Redux-saga vs Redux-observale | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="Redux-saga vs Redux-observale side by side comparison."><meta property=og:description content="Redux-saga vs Redux-observale side by side comparison."><link rel=canonical href=https://zoubingwu.com/2018-03-17/redux-saga-vs-redux-observale><meta property=og:url content=https://zoubingwu.com/2018-03-17/redux-saga-vs-redux-observale><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2018-03-17T22:38:31.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="Redux-saga vs Redux-observale | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>Redux-saga vs Redux-observale</div><span class=post-date><time>17 Mar 2018</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>rxjs</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>observable</span></a></li></ul></div><h2 id=前言>前言</h2><p>之前工作中一直使用的 redux-saga 来处理非常复杂的异步场景, 在接触到 Rxjs 后马上就被这种编程方式所吸引。它通过使用 observable 序列搭配强大的多种操作符来处理各种异步和事件。</p><blockquote><p>Think of RxJS as Lodash for events.</p></blockquote><p>这里我们罗列一下常见的场景，来比较一下这两者的写法。</p><h2 id=metal-model>Metal Model</h2><p>这两者的模式有着本质的区别：</p><h4 id=saga--worker--watcher>Saga = Worker + Watcher</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> API </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Watcher</span><span style="color: #24292E">(){</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">takeEvery</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;do_thing&#39;</span><span style="color: #24292E">, Worker)</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Worker</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">users</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #005CC5">API</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;/api/users&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;done&#39;</span><span style="color: #24292E">, users})</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> API </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Watcher</span><span style="color: #C9D1D9">(){</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">takeEvery</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;do_thing&#39;</span><span style="color: #C9D1D9">, Worker)</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Worker</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">users</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">API</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/api/users&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;done&#39;</span><span style="color: #C9D1D9">, users})</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rxjs--epic-type--operators->Rxjs = Epic( Type + Operators )</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> API </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Epic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;do_thing&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #005CC5">API</span><span style="color: #24292E">.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;/api/users&#39;</span><span style="color: #24292E">))</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(</span><span style="color: #E36209">users</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;done&#39;</span><span style="color: #24292E">, users}))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> API </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Epic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;do_thing&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #79C0FF">API</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/api/users&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">users</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;done&#39;</span><span style="color: #C9D1D9">, users}))</span></span></code></pre></div>
</code></pre><h2 id=场景比较>场景比较</h2><p>我们可以从一些最简单的场景开始。</p><h3 id=fetch-user-from-apiusers1>Fetch User from <code>/api/users/1</code></h3><h4 id=saga>Saga:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> axios </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">watchSaga</span><span style="color: #24292E">(){</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">takeEvery</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user&#39;</span><span style="color: #24292E">, fetchUser) </span><span style="color: #6A737D">// waiting for action (fetch_user)</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fetchUser</span><span style="color: #24292E">(</span><span style="color: #E36209">action</span><span style="color: #24292E">){</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">try</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_ing&#39;</span><span style="color: #24292E">})</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">response</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(axios.get,</span><span style="color: #032F62">&#39;/api/users/1&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_done&#39;</span><span style="color: #24292E">,user:response.data})</span></span>
<span class=line><span style="color: #24292E">  } </span><span style="color: #D73A49">catch</span><span style="color: #24292E"> (error) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_error&#39;</span><span style="color: #24292E">,error})</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> axios </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">watchSaga</span><span style="color: #C9D1D9">(){</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">takeEvery</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user&#39;</span><span style="color: #C9D1D9">, fetchUser) </span><span style="color: #8B949E">// waiting for action (fetch_user)</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetchUser</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">action</span><span style="color: #C9D1D9">){</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">try</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_ing&#39;</span><span style="color: #C9D1D9">})</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">response</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(axios.get,</span><span style="color: #A5D6FF">&#39;/api/users/1&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_done&#39;</span><span style="color: #C9D1D9">,user:response.data})</span></span>
<span class=line><span style="color: #C9D1D9">  } </span><span style="color: #FF7B72">catch</span><span style="color: #C9D1D9"> (error) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_error&#39;</span><span style="color: #C9D1D9">,error})</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rx>Rx:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> axios </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fetchUserEpic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_ing&#39;</span><span style="color: #24292E">}))</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">axios.</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;/api/users/1&#39;</span><span style="color: #24292E">))</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(</span><span style="color: #E36209">response</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">response.data)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(</span><span style="color: #E36209">user</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_done&#39;</span><span style="color: #24292E">, user}))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> axios </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetchUserEpic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_ing&#39;</span><span style="color: #C9D1D9">}))</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">axios.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/api/users/1&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">response</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">response.data)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">user</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_done&#39;</span><span style="color: #C9D1D9">, user}))</span></span></code></pre></div>
</code></pre><h3 id=fetch-user-from-apiusers1-cancelable>Fetch User from <code>/api/users/1</code> (cancelable)</h3><h4 id=saga-1>Saga:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> { take, put, call, fork, cancel } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> API </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fetchUser</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_ing&#39;</span><span style="color: #24292E">})</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">user</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(</span><span style="color: #005CC5">API</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_done&#39;</span><span style="color: #24292E">, user})</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Watcher</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">while</span><span style="color: #24292E">(</span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user&#39;</span><span style="color: #24292E">)){</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">bgSyncTask</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fork</span><span style="color: #24292E">(fetchUser)</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user_cancel&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancel</span><span style="color: #24292E">(bgSyncTask)</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { take, put, call, fork, cancel } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> API </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetchUser</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_ing&#39;</span><span style="color: #C9D1D9">})</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">user</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">API</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_done&#39;</span><span style="color: #C9D1D9">, user})</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">Watcher</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">take</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user&#39;</span><span style="color: #C9D1D9">)){</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">bgSyncTask</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fork</span><span style="color: #C9D1D9">(fetchUser)</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">take</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user_cancel&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">cancel</span><span style="color: #C9D1D9">(bgSyncTask)</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rx-1>Rx:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fetchUserEpic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    actions$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;fetch_user_ing&#39;</span><span style="color: #24292E">}))</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Observable</span></span>
<span class=line><span style="color: #24292E">                .ajax</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;/api/user/1&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(</span><span style="color: #E36209">user</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({ type: </span><span style="color: #032F62">&#39;fetch_user_done&#39;</span><span style="color: #24292E">, user }))</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">takeUntil</span><span style="color: #24292E">(action$.</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;fetch_user_cancel&#39;</span><span style="color: #24292E">))</span></span>
<span class=line><span style="color: #24292E">        })</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fetchUserEpic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    actions$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;fetch_user_ing&#39;</span><span style="color: #C9D1D9">}))</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> Observable</span></span>
<span class=line><span style="color: #C9D1D9">                .ajax</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/api/user/1&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">user</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ({ type: </span><span style="color: #A5D6FF">&#39;fetch_user_done&#39;</span><span style="color: #C9D1D9">, user }))</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">takeUntil</span><span style="color: #C9D1D9">(action$.</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;fetch_user_cancel&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class=line><span style="color: #C9D1D9">        })</span></span></code></pre></div>
</code></pre><h3 id=连续执行序列>连续执行序列</h3><h4 id=saga-2>Saga:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker1</span><span style="color: #24292E">() { </span><span style="color: #D73A49">...</span><span style="color: #24292E"> }</span></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker2</span><span style="color: #24292E">() { </span><span style="color: #D73A49">...</span><span style="color: #24292E"> }</span></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker3</span><span style="color: #24292E">() { </span><span style="color: #D73A49">...</span><span style="color: #24292E"> }</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">watcher</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">score1</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker1</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">(({type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score1})</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  const score2 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker2</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">(({type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score2})</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  const score3 </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">worker3</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">(({type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score3})</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker1</span><span style="color: #C9D1D9">() { </span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9"> }</span></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker2</span><span style="color: #C9D1D9">() { </span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9"> }</span></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker3</span><span style="color: #C9D1D9">() { </span><span style="color: #FF7B72">...</span><span style="color: #C9D1D9"> }</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">watcher</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">score1</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker1</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">(({type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score1})</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  const score2 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker2</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">(({type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score2})</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  const score3 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">worker3</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">(({type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score3})</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rx-2>Rx:</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">score1Epic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;score1&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(worker1)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(</span><span style="color: #E36209">score</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">             </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Observable.</span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span></span>
<span class=line><span style="color: #24292E">                {type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score},</span></span>
<span class=line><span style="color: #24292E">                {type:</span><span style="color: #032F62">&#39;score2&#39;</span><span style="color: #24292E">}</span></span>
<span class=line><span style="color: #24292E">             )</span></span>
<span class=line><span style="color: #24292E">         })</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">score2Epic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;score2&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(worker2)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(</span><span style="color: #E36209">score</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Observable.</span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(</span></span>
<span class=line><span style="color: #24292E">                {type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score},</span></span>
<span class=line><span style="color: #24292E">                {type:</span><span style="color: #032F62">&#39;score3&#39;</span><span style="color: #24292E">}</span></span>
<span class=line><span style="color: #24292E">            )</span></span>
<span class=line><span style="color: #24292E">        })</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">score3Epic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;score3&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">reduce</span><span style="color: #24292E">(worker3)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(</span><span style="color: #E36209">score</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;show_score&#39;</span><span style="color: #24292E">, score}))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">score1Epic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;score1&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">reduce</span><span style="color: #C9D1D9">(worker1)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">score</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">             </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> Observable.</span><span style="color: #D2A8FF">merge</span><span style="color: #C9D1D9">(</span></span>
<span class=line><span style="color: #C9D1D9">                {type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score},</span></span>
<span class=line><span style="color: #C9D1D9">                {type:</span><span style="color: #A5D6FF">&#39;score2&#39;</span><span style="color: #C9D1D9">}</span></span>
<span class=line><span style="color: #C9D1D9">             )</span></span>
<span class=line><span style="color: #C9D1D9">         })</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">score2Epic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;score2&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">reduce</span><span style="color: #C9D1D9">(worker2)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">score</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> Observable.</span><span style="color: #D2A8FF">merge</span><span style="color: #C9D1D9">(</span></span>
<span class=line><span style="color: #C9D1D9">                {type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score},</span></span>
<span class=line><span style="color: #C9D1D9">                {type:</span><span style="color: #A5D6FF">&#39;score3&#39;</span><span style="color: #C9D1D9">}</span></span>
<span class=line><span style="color: #C9D1D9">            )</span></span>
<span class=line><span style="color: #C9D1D9">        })</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">score3Epic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;score3&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">reduce</span><span style="color: #C9D1D9">(worker3)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">score</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;show_score&#39;</span><span style="color: #C9D1D9">, score}))</span></span></code></pre></div>
</code></pre><h3 id=login-token-logout-cancel>Login, token, Logout, Cancel</h3><h4 id=with-redux>with redux</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">store</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    token: </span><span style="color: #005CC5">null</span><span style="color: #24292E">,</span></span>
<span class=line><span style="color: #24292E">    isFetching: </span><span style="color: #005CC5">false</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">tokenReducer</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">state</span><span style="color: #D73A49">=</span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #E36209">action</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">switch</span><span style="color: #24292E"> (action.type) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_success&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> action.token</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_error&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_cancel&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;logout&#39;</span></span>
<span class=line><span style="color: #24292E">            return </span><span style="color: #005CC5">null</span></span>
<span class=line><span style="color: #24292E">        default:</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> state</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isFetching</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">state</span><span style="color: #D73A49">=</span><span style="color: #005CC5">false</span><span style="color: #24292E">, </span><span style="color: #E36209">action</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">switch</span><span style="color: #24292E"> (action.type) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_request&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_success&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_error&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;login_cancel&#39;</span><span style="color: #24292E">:</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;logout&#39;</span></span>
<span class=line><span style="color: #24292E">            return </span><span style="color: #005CC5">false</span></span>
<span class=line><span style="color: #24292E">        default:</span></span>
<span class=line><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> state</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">store</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    token: </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">,</span></span>
<span class=line><span style="color: #C9D1D9">    isFetching: </span><span style="color: #79C0FF">false</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">tokenReducer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">state</span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">action</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">switch</span><span style="color: #C9D1D9"> (action.type) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_success&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> action.token</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_error&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_cancel&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;logout&#39;</span></span>
<span class=line><span style="color: #C9D1D9">            return </span><span style="color: #79C0FF">null</span></span>
<span class=line><span style="color: #C9D1D9">        default:</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> state</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">isFetching</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">state</span><span style="color: #FF7B72">=</span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">action</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">switch</span><span style="color: #C9D1D9"> (action.type) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_request&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_success&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_error&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;login_cancel&#39;</span><span style="color: #C9D1D9">:</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;logout&#39;</span></span>
<span class=line><span style="color: #C9D1D9">            return </span><span style="color: #79C0FF">false</span></span>
<span class=line><span style="color: #C9D1D9">        default:</span></span>
<span class=line><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> state</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=saga-3>Saga</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> { take, put, call, fork, cancel } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> Api </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loginWatcher</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> { </span><span style="color: #005CC5">user</span><span style="color: #24292E">, </span><span style="color: #005CC5">password</span><span style="color: #24292E"> } </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;login_request&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        , task </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">fork</span><span style="color: #24292E">(authorize, user, password)</span></span>
<span class=line><span style="color: #24292E">        , action </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take</span><span style="color: #24292E">([</span><span style="color: #032F62">&#39;logout&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;login_error&#39;</span><span style="color: #24292E">])</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (action.type </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;logout&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancel</span><span style="color: #24292E">(task)</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;login_cancel&#39;</span><span style="color: #24292E">})</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">authorize</span><span style="color: #24292E">(</span><span style="color: #E36209">user</span><span style="color: #24292E">, </span><span style="color: #E36209">password</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">try</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">token</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(Api.getUserToken, user, password)</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type: </span><span style="color: #032F62">&#39;login_success&#39;</span><span style="color: #24292E">, token})</span></span>
<span class=line><span style="color: #24292E">  } </span><span style="color: #D73A49">catch</span><span style="color: #24292E"> (error) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({type: </span><span style="color: #032F62">&#39;login_error&#39;</span><span style="color: #24292E">, error})</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { take, put, call, fork, cancel } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> Api </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">loginWatcher</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">user</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">password</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">take</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;login_request&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        , task </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">fork</span><span style="color: #C9D1D9">(authorize, user, password)</span></span>
<span class=line><span style="color: #C9D1D9">        , action </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">take</span><span style="color: #C9D1D9">([</span><span style="color: #A5D6FF">&#39;logout&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;login_error&#39;</span><span style="color: #C9D1D9">])</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (action.type </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;logout&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">cancel</span><span style="color: #C9D1D9">(task)</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;login_cancel&#39;</span><span style="color: #C9D1D9">})</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">authorize</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">user</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">password</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">try</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">token</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(Api.getUserToken, user, password)</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type: </span><span style="color: #A5D6FF">&#39;login_success&#39;</span><span style="color: #C9D1D9">, token})</span></span>
<span class=line><span style="color: #C9D1D9">  } </span><span style="color: #FF7B72">catch</span><span style="color: #C9D1D9"> (error) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({type: </span><span style="color: #A5D6FF">&#39;login_error&#39;</span><span style="color: #C9D1D9">, error})</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rxjs>Rxjs</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">authEpic</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #E36209">action$</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">    action$</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;login_request&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        .</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(({</span><span style="color: #E36209">payload</span><span style="color: #24292E">:{</span><span style="color: #E36209">user</span><span style="color: #24292E">,</span><span style="color: #E36209">password</span><span style="color: #24292E">}}) </span><span style="color: #D73A49">=&gt;</span></span>
<span class=line><span style="color: #24292E">            Observable</span></span>
<span class=line><span style="color: #24292E">                .ajax</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">get</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;/api/userToken&#39;</span><span style="color: #24292E">, { user, password })</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">map</span><span style="color: #24292E">(({</span><span style="color: #E36209">token</span><span style="color: #24292E">}) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({ type: </span><span style="color: #032F62">&#39;login_success&#39;</span><span style="color: #24292E">, token }))</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">takeUntil</span><span style="color: #24292E">(action$.</span><span style="color: #6F42C1">ofType</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;login_cancel&#39;</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;logout&#39;</span><span style="color: #24292E">))</span></span>
<span class=line><span style="color: #24292E">                .</span><span style="color: #6F42C1">catch</span><span style="color: #24292E">(</span><span style="color: #E36209">error</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> Rx.Observable.</span><span style="color: #6F42C1">of</span><span style="color: #24292E">({type:</span><span style="color: #032F62">&#39;login_error&#39;</span><span style="color: #24292E">, error}))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">authEpic</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">action$</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">    action$</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;login_request&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(({</span><span style="color: #FFA657">payload</span><span style="color: #C9D1D9">:{</span><span style="color: #FFA657">user</span><span style="color: #C9D1D9">,</span><span style="color: #FFA657">password</span><span style="color: #C9D1D9">}}) </span><span style="color: #FF7B72">=&gt;</span></span>
<span class=line><span style="color: #C9D1D9">            Observable</span></span>
<span class=line><span style="color: #C9D1D9">                .ajax</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/api/userToken&#39;</span><span style="color: #C9D1D9">, { user, password })</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">(({</span><span style="color: #FFA657">token</span><span style="color: #C9D1D9">}) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> ({ type: </span><span style="color: #A5D6FF">&#39;login_success&#39;</span><span style="color: #C9D1D9">, token }))</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">takeUntil</span><span style="color: #C9D1D9">(action$.</span><span style="color: #D2A8FF">ofType</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;login_cancel&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;logout&#39;</span><span style="color: #C9D1D9">))</span></span>
<span class=line><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> Rx.Observable.</span><span style="color: #D2A8FF">of</span><span style="color: #C9D1D9">({type:</span><span style="color: #A5D6FF">&#39;login_error&#39;</span><span style="color: #C9D1D9">, error}))</span></span></code></pre></div>
</code></pre><h3 id=logger>logger</h3><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #D73A49">while</span><span style="color: #24292E"> (</span><span style="color: #005CC5">true</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">action</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">take</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;*&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">        , state </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">select</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;action:&#39;</span><span style="color: #24292E">, action)</span></span>
<span class=line><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;state:&#39;</span><span style="color: #24292E">, state)</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">do</span><span style="color: #24292E">(</span><span style="color: #E36209">value</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(value))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #FF7B72">while</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">action</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">take</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;*&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">        , state </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">select</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;action:&#39;</span><span style="color: #C9D1D9">, action)</span></span>
<span class=line><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;state:&#39;</span><span style="color: #C9D1D9">, state)</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">do</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">value</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(value))</span></span></code></pre></div>
</code></pre><h3 id=take-latest-request>Take latest request</h3><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #6F42C1">takeLatest</span><span style="color: #24292E">()</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">switchMap</span><span style="color: #24292E">()</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #D2A8FF">takeLatest</span><span style="color: #C9D1D9">()</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">switchMap</span><span style="color: #C9D1D9">()</span></span></code></pre></div>
</code></pre><h3 id=retry-with-delay-1000ms>Retry with delay (1000ms)</h3><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ----- Saga ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">...</span><span style="color: #24292E"> still thinking about it</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ----- Rxjs ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">retryWhen</span><span style="color: #24292E">(</span><span style="color: #E36209">errors</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> errors.</span><span style="color: #6F42C1">delay</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">).</span><span style="color: #6F42C1">scan</span><span style="color: #24292E">((</span><span style="color: #E36209">errorCount</span><span style="color: #24292E">, </span><span style="color: #E36209">err</span><span style="color: #24292E">)</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">if</span><span style="color: #24292E">(errorCount </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">) </span><span style="color: #D73A49">return</span><span style="color: #24292E"> errorCount </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> err</span></span>
<span class=line><span style="color: #24292E">    }, </span><span style="color: #005CC5">0</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">})</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ----- Saga ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">...</span><span style="color: #C9D1D9"> still thinking about it</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ----- Rxjs ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">retryWhen</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">errors</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> errors.</span><span style="color: #D2A8FF">delay</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">scan</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">errorCount</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">(errorCount </span><span style="color: #FF7B72">&lt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> errorCount </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> err</span></span>
<span class=line><span style="color: #C9D1D9">    }, </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">})</span></span></code></pre></div>
</code></pre><h3 id=error-handling>Error Handling</h3><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #D73A49">try</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #6A737D">// ... do things</span></span>
<span class=line><span style="color: #24292E">} </span><span style="color: #D73A49">catch</span><span style="color: #24292E"> (error) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">put</span><span style="color: #24292E">({ type:</span><span style="color: #032F62">&#39;fetch_user_error&#39;</span><span style="color: #24292E">,error })</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">catch</span><span style="color: #24292E">(</span><span style="color: #E36209">error</span><span style="color: #24292E"> </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> Observable.</span><span style="color: #6F42C1">of</span><span style="color: #24292E">({ type:</span><span style="color: #032F62">&#39;fetch_user_error&#39;</span><span style="color: #24292E">, error }))</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #FF7B72">try</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// ... do things</span></span>
<span class=line><span style="color: #C9D1D9">} </span><span style="color: #FF7B72">catch</span><span style="color: #C9D1D9"> (error) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">put</span><span style="color: #C9D1D9">({ type:</span><span style="color: #A5D6FF">&#39;fetch_user_error&#39;</span><span style="color: #C9D1D9">,error })</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">error</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> Observable.</span><span style="color: #D2A8FF">of</span><span style="color: #C9D1D9">({ type:</span><span style="color: #A5D6FF">&#39;fetch_user_error&#39;</span><span style="color: #C9D1D9">, error }))</span></span></code></pre></div>
</code></pre><h3 id=并发执行>并发执行</h3><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #D73A49">import</span><span style="color: #24292E"> { call } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;redux-saga/effects&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> [</span><span style="color: #005CC5">users</span><span style="color: #24292E">, </span><span style="color: #005CC5">repos</span><span style="color: #24292E">]  </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> [</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(fetch, </span><span style="color: #032F62">&#39;/users&#39;</span><span style="color: #24292E">),</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(fetch, </span><span style="color: #032F62">&#39;/repos&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #24292E">]</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">flatMap</span><span style="color: #24292E">(()</span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E">{</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Observable.</span><span style="color: #6F42C1">merge</span><span style="color: #24292E">(promiseA, promiseB)</span></span>
<span class=line><span style="color: #24292E">})</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { call } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;redux-saga/effects&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> [</span><span style="color: #79C0FF">users</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">repos</span><span style="color: #C9D1D9">]  </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> [</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(fetch, </span><span style="color: #A5D6FF">&#39;/users&#39;</span><span style="color: #C9D1D9">),</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(fetch, </span><span style="color: #A5D6FF">&#39;/repos&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #C9D1D9">]</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">flatMap</span><span style="color: #C9D1D9">(()</span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9">{</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> Observable.</span><span style="color: #D2A8FF">merge</span><span style="color: #C9D1D9">(promiseA, promiseB)</span></span>
<span class=line><span style="color: #C9D1D9">})</span></span></code></pre></div>
</code></pre><h3 id=throttling-debouncing-retrying>Throttling, Debouncing, Retrying</h3><h4 id=saga-4>Saga</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">throttle</span><span style="color: #24292E">(</span><span style="color: #005CC5">500</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;input_change&#39;</span><span style="color: #24292E">, fun)</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(delay, </span><span style="color: #005CC5">500</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function*</span><span style="color: #24292E"> </span><span style="color: #6F42C1">retryAPI</span><span style="color: #24292E">(</span><span style="color: #E36209">data</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">for</span><span style="color: #24292E">(</span><span style="color: #D73A49">let</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">try</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">apiResponse</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(apiRequest, { data });</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> apiResponse;</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">catch</span><span style="color: #24292E">(err) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">if</span><span style="color: #24292E">(i </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">3</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">        </span><span style="color: #D73A49">yield</span><span style="color: #24292E"> </span><span style="color: #6F42C1">call</span><span style="color: #24292E">(delay, </span><span style="color: #005CC5">2000</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">      }</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;API request failed&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">throttle</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;input_change&#39;</span><span style="color: #C9D1D9">, fun)</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(delay, </span><span style="color: #79C0FF">500</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function*</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">retryAPI</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">data</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&lt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">try</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">apiResponse</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(apiRequest, { data });</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> apiResponse;</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">catch</span><span style="color: #C9D1D9">(err) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9">(i </span><span style="color: #FF7B72">&lt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">yield</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">call</span><span style="color: #C9D1D9">(delay, </span><span style="color: #79C0FF">2000</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">      }</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Error</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;API request failed&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><h4 id=rx-3>Rx</h4><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">throtleTime</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">debouncing</span><span style="color: #24292E">(</span><span style="color: #005CC5">1000</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">.</span><span style="color: #6F42C1">retry</span><span style="color: #24292E">(</span><span style="color: #005CC5">3</span><span style="color: #24292E">)</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">throtleTime</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">debouncing</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1000</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">retry</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">)</span></span></code></pre></div>
</code></pre><h3 id=ref>ref</h3><ul><li><p><a href=http://reactivex.io/rxjs/manual/overview.html>http://reactivex.io/rxjs/manual/overview.html</a></p></li><li><p><a href=https://hackmd.io/s/H1xLHUQ8e>Redux-Saga V.S. Redux-Observable</a></p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>