<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>Redux-saga vs Redux-observale | https://zoubingwu.com</title><meta property=og:title content="Redux-saga vs Redux-observale | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="Redux-saga vs Redux-observale side by side comparison."><meta property=og:description content="Redux-saga vs Redux-observale side by side comparison."><link rel=canonical href=https://zoubingwu.com/2018-03-17/redux-saga-vs-redux-observale><meta property=og:url content=https://zoubingwu.com/2018-03-17/redux-saga-vs-redux-observale><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2018-03-17T22:38:31.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="Redux-saga vs Redux-observale | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>Redux-saga vs Redux-observale</div><span class=post-date><time>17 Mar 2018</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>rxjs</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>observable</span></a></li></ul></div><h2 id=前言>前言</h2><p>之前工作中一直使用的 redux-saga 来处理非常复杂的异步场景, 在接触到 Rxjs 后马上就被这种编程方式所吸引。它通过使用 observable 序列搭配强大的多种操作符来处理各种异步和事件。</p><blockquote><p>Think of RxJS as Lodash for events.</p></blockquote><p>这里我们罗列一下常见的场景，来比较一下这两者的写法。</p><h2 id=metal-model>Metal Model</h2><p>这两者的模式有着本质的区别：</p><h4 id=saga--worker--watcher>Saga = Worker + Watcher</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">API</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Watcher</span><span style="color: #ABB2BF">(){</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">takeEvery</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;do_thing&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Worker</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Worker</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">users</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">API</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/api/users&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;done&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">users</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rxjs--epic-type--operators->Rxjs = Epic( Type + Operators )</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">API</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Epic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;do_thing&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #E5C07B">API</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/api/users&#39;</span><span style="color: #ABB2BF">))</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">users</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;done&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">users</span><span style="color: #ABB2BF">}))</span></span></code></pre>
</code></pre><h2 id=场景比较>场景比较</h2><p>我们可以从一些最简单的场景开始。</p><h3 id=fetch-user-from-apiusers1>Fetch User from <code>/api/users/1</code></h3><h4 id=saga>Saga:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">axios</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">watchSaga</span><span style="color: #ABB2BF">(){</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">takeEvery</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">fetchUser</span><span style="color: #ABB2BF">) </span><span style="color: #7F848E; font-style: italic">// waiting for action (fetch_user)</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchUser</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">action</span><span style="color: #ABB2BF">){</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_ing&#39;</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">axios</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">get</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;/api/users/1&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_done&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">:</span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">  } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_error&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rx>Rx:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">axios</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;axios&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchUserEpic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_ing&#39;</span><span style="color: #ABB2BF">}))</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #E5C07B">axios</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/api/users/1&#39;</span><span style="color: #ABB2BF">))</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">response</span><span style="color: #C678DD">=&gt;</span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_done&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">}))</span></span></code></pre>
</code></pre><h3 id=fetch-user-from-apiusers1-cancelable>Fetch User from <code>/api/users/1</code> (cancelable)</h3><h4 id=saga-1>Saga:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">take</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">put</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">call</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">fork</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">cancel</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">API</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchUser</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_ing&#39;</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">API</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_done&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Watcher</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">while</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">take</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user&#39;</span><span style="color: #ABB2BF">)){</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">bgSyncTask</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fork</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fetchUser</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">take</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user_cancel&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cancel</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">bgSyncTask</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rx-1>Rx:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchUserEpic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">actions$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_ing&#39;</span><span style="color: #ABB2BF">}))</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">Observable</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #E06C75">ajax</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/api/user/1&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({ </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;fetch_user_done&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF"> }))</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">takeUntil</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">action$</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;fetch_user_cancel&#39;</span><span style="color: #ABB2BF">))</span></span>
<span class=line><span style="color: #ABB2BF">        })</span></span></code></pre>
</code></pre><h3 id=连续执行序列>连续执行序列</h3><h4 id=saga-2>Saga:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker1</span><span style="color: #ABB2BF">() { ... }</span></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker2</span><span style="color: #ABB2BF">() { ... }</span></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker3</span><span style="color: #ABB2BF">() { ... }</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">watcher</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">score1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker1</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score1</span><span style="color: #ABB2BF">})</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">const</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">score2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker2</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score2</span><span style="color: #ABB2BF">})</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">const</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">score3</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">worker3</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">(({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score3</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rx-2>Rx:</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">score1Epic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;score1&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">worker1</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">score</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">             </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Observable</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">merge</span><span style="color: #ABB2BF">(</span></span>
<span class=line><span style="color: #ABB2BF">                {</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">},</span></span>
<span class=line><span style="color: #ABB2BF">                {</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;score2&#39;</span><span style="color: #ABB2BF">}</span></span>
<span class=line><span style="color: #ABB2BF">             )</span></span>
<span class=line><span style="color: #ABB2BF">         })</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">score2Epic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;score2&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">worker2</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">score</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Observable</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">merge</span><span style="color: #ABB2BF">(</span></span>
<span class=line><span style="color: #ABB2BF">                {</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">},</span></span>
<span class=line><span style="color: #ABB2BF">                {</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;score3&#39;</span><span style="color: #ABB2BF">}</span></span>
<span class=line><span style="color: #ABB2BF">            )</span></span>
<span class=line><span style="color: #ABB2BF">        })</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">score3Epic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;score3&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">worker3</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">score</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;show_score&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">score</span><span style="color: #ABB2BF">}))</span></span></code></pre>
</code></pre><h3 id=login-token-logout-cancel>Login, token, Logout, Cancel</h3><h4 id=with-redux>with redux</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">store</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">token</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">,</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">isFetching</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">tokenReducer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">state</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">action</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">switch</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">action</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_success&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">action</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">token</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_error&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_cancel&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;logout&#39;</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #E06C75">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #E06C75">default</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">isFetching</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">state</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">action</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">switch</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">action</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_request&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_success&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_error&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;login_cancel&#39;</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">case</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;logout&#39;</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #E06C75">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #E06C75">default</span><span style="color: #ABB2BF">:</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=saga-3>Saga</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">take</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">put</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">call</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">fork</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">cancel</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;redux-saga/effects&#39;</span></span>
<span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">Api</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;...&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">loginWatcher</span><span style="color: #ABB2BF">() {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">password</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">take</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;login_request&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        , </span><span style="color: #E06C75">task</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fork</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">authorize</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        , </span><span style="color: #E06C75">action</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">take</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&#39;logout&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;login_error&#39;</span><span style="color: #ABB2BF">])</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">action</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;logout&#39;</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cancel</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">task</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;login_cancel&#39;</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">authorize</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">password</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">token</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">Api</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">getUserToken</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;login_success&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">token</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">  } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;login_error&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">})</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rxjs>Rxjs</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">authEpic</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">action$</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #E06C75">action$</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;login_request&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        .</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(({</span><span style="color: #E06C75">payload</span><span style="color: #ABB2BF">:{</span><span style="color: #E06C75; font-style: italic">user</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75; font-style: italic">password</span><span style="color: #ABB2BF">}}) </span><span style="color: #C678DD">=&gt;</span></span>
<span class=line><span style="color: #ABB2BF">            </span><span style="color: #E06C75">Observable</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #E06C75">ajax</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;/api/userToken&#39;</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">user</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF"> })</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">(({</span><span style="color: #E06C75; font-style: italic">token</span><span style="color: #ABB2BF">}) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({ </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;login_success&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">token</span><span style="color: #ABB2BF"> }))</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">takeUntil</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">action$</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">ofType</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;login_cancel&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;logout&#39;</span><span style="color: #ABB2BF">))</span></span>
<span class=line><span style="color: #ABB2BF">                .</span><span style="color: #61AFEF">catch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">error</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Rx</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Observable</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">of</span><span style="color: #ABB2BF">({</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;login_error&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">}))</span></span></code></pre>
</code></pre><h3 id=logger>logger</h3><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #C678DD">while</span><span style="color: #ABB2BF"> (</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">action</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">take</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;*&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">        , </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">select</span><span style="color: #ABB2BF">()</span></span>
<span class=line><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;action:&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">action</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;state:&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">do</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #C678DD">=&gt;</span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">))</span></span></code></pre>
</code></pre><h3 id=take-latest-request>Take latest request</h3><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #61AFEF">takeLatest</span><span style="color: #ABB2BF">()</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">switchMap</span><span style="color: #ABB2BF">()</span></span></code></pre>
</code></pre><h3 id=retry-with-delay-1000ms>Retry with delay (1000ms)</h3><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ----- Saga ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">... </span><span style="color: #E06C75">still</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">thinking</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">about</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">it</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ----- Rxjs ----- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">retryWhen</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">errors</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">delay</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">scan</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">errorCount</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">errorCount</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">errorCount</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">err</span></span>
<span class=line><span style="color: #ABB2BF">    }, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">})</span></span></code></pre>
</code></pre><h3 id=error-handling>Error Handling</h3><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// ... do things</span></span>
<span class=line><span style="color: #ABB2BF">} </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">put</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_error&#39;</span><span style="color: #ABB2BF">,</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF"> })</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">catch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">error</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Observable</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">of</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">:</span><span style="color: #98C379">&#39;fetch_user_error&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF"> }))</span></span></code></pre>
</code></pre><h3 id=并发执行>并发执行</h3><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ----- Saga ----- \\</span></span>
<span class=line><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">call</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;redux-saga/effects&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">users</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">repos</span><span style="color: #ABB2BF">]  </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> [</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fetch</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;/users&#39;</span><span style="color: #ABB2BF">),</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fetch</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;/repos&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">]</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ----- Rxjs ----- \\</span></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">flatMap</span><span style="color: #ABB2BF">(()</span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF">{</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Observable</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">merge</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">promiseA</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">promiseB</span><span style="color: #ABB2BF">)</span></span>
<span class=line><span style="color: #ABB2BF">})</span></span></code></pre>
</code></pre><h3 id=throttling-debouncing-retrying>Throttling, Debouncing, Retrying</h3><h4 id=saga-4>Saga</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">throttle</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">500</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;input_change&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">fun</span><span style="color: #ABB2BF">)</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">delay</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">500</span><span style="color: #ABB2BF">)</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">function*</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">retryAPI</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">data</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">i</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">    </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">apiResponse</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">apiRequest</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">data</span><span style="color: #ABB2BF"> });</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">apiResponse</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">err</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">      </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">) {</span></span>
<span class=line><span style="color: #ABB2BF">        </span><span style="color: #C678DD">yield</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">delay</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">2000</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">      }</span></span>
<span class=line><span style="color: #ABB2BF">    }</span></span>
<span class=line><span style="color: #ABB2BF">  }</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #C678DD">throw</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;API request failed&#39;</span><span style="color: #ABB2BF">);</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h4 id=rx-3>Rx</h4><pre><code class=language-js><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// ---- Throttling ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">throtleTime</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">)</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ---- Debouncing ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">debouncing</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">)</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// ---- Retrying ---- \\</span></span>
<span class=line></span>
<span class=line><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">retry</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">)</span></span></code></pre>
</code></pre><h3 id=ref>ref</h3><ul><li><p><a href=http://reactivex.io/rxjs/manual/overview.html>http://reactivex.io/rxjs/manual/overview.html</a></p></li><li><p><a href=https://hackmd.io/s/H1xLHUQ8e>Redux-Saga V.S. Redux-Observable</a></p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>