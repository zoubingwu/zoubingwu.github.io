<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>JSON解析器的简单实现 | https://zoubingwu.com</title><meta property=og:title content="JSON解析器的简单实现 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content=聊聊数据结构和JSON，以及自己动手实现一个JSON.parse><meta property=og:description content=聊聊数据结构和JSON，以及自己动手实现一个JSON.parse><link rel=canonical href=https://zoubingwu.com/2017-07-31/json解析器的简单实现><meta property=og:url content=https://zoubingwu.com/2017-07-31/json解析器的简单实现><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-07-31T10:37:41.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="JSON解析器的简单实现 | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>JSON解析器的简单实现</div><span class=post-date><time>31 Jul 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>javascript</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>json</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>parser</span></a></li></ul></div><h3 id=前言>前言</h3><p>不管多么复杂庞大的数据，它的基本组成其实是很简单的，从结构上看所有的数据都可以分解成三种类型：</p><ol><li><code>scalar</code> 标量，比如所有的名词。</li><li><code>sequence</code>序列，即标量的合集，编程语言中的数组。</li><li><code>mapping</code>映射，键值对，比如JS中的对象，python中的dict。</li></ol><p>因此，在编程语言中，只要有了数组和对象，就可以表示一切数据了。在 <code>JavaScript</code> 中虽然没有栈，链表，二叉树之类的数据结构，但都可以简单模拟出来。而为了储存数据，JSON这种目前应用极广的非常轻量的数据交换格式终于诞生了，它的规则极其简单：</p><ol><li>并列的数据之间用逗号（&quot;, &quot;）分隔。</li><li>映射用冒号（&quot;: &quot;）表示。</li><li>并列数据的集合（数组）用方括号(&quot;[]&quot;)表示。</li><li>映射的集合（对象）用大括号（&quot;{}&quot;）表示。</li></ol><p>我们可以看出来，一组JSON数据它其实要么就是数组，要不就是一个键值对合集的对象。</p><h3 id=解析>解析</h3><p>JSON格式结构清晰简单，因此解析起来也非常方便，在解析文本的过程中，遇到一个左大括号（{）时，表示需要从当前字符开始，解析出一个对象，而解析对象的过程则是解析出多对 key/value，每解析完一对，如果遇到了右大括号（}），则对这个对象的解析就结束了，而如果遇到的不是右大括号，就解析下一对 key/value，直到遇见右大括号。而解析出一对 key/value，则是必须先解析出一个字符串，然后一个冒号（:），然后是这个 key 对应的值。</p><p>同理，当遇到一个左方括号（[）时，需要从这个字符开始解析出一个数组；而解析数组，则是解析出多个由逗号分隔的值，直到解析完一个值后遇到的不是逗号而是右方括号（]），则这个数组解析完毕。</p><p>遇到一个双引号（&quot;）时，需要从当前位置开始解析出一个字符串。</p><p>遇到字母 “n” 的话，则是从当前位置开始往后读 4 个字符，且读到的 4 个字符组成的字符串必须是“null”，否则就应该报错。</p><p>遇到字母 “t” 的话，则是从当前位置开始往后读 4 个字符，且读到的 4 个字符组成的字符串必须是“true”，否则就应该报错。</p><p>遇到字母 “f” 的话，则是从当前位置开始往后读 5 个字符，且读到的 5 个字符组成的字符串必须是“false”，否则就应该报错。</p><p>剩下的就是数值了。</p><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #6A737D">// 声明一个测试用的字符串，暂时不考虑特殊的情况，完成功能后再增强鲁棒性</span></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">jsonStr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;{&quot;a&quot;:1,&quot;b&quot;:true,&quot;c&quot;:false,&quot;foo&quot;:null,&quot;bar&quot;:[1,2,3]}&#39;</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #8B949E">// 声明一个测试用的字符串，暂时不考虑特殊的情况，完成功能后再增强鲁棒性</span></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">jsonStr</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;{&quot;a&quot;:1,&quot;b&quot;:true,&quot;c&quot;:false,&quot;foo&quot;:null,&quot;bar&quot;:[1,2,3]}&#39;</span></span></code></pre></div>
</code></pre><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parse</span><span style="color: #24292E">(</span><span style="color: #E36209">jsonstr</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">let</span><span style="color: #24292E"> i </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 使用一个全局变量 i 来保存我们解析到哪里了，或者说下一步要从哪里开始解析</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> jsonStr</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseValue</span><span style="color: #24292E">()</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 然后先实现一个解析出一个值的函数，名为 parseValue，同时，它解析完一个“值”后，会把 i 移动到下一个即将开始解析的位置，我们所有的函数都依赖这个变量i</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseValue</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;{&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseObject</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;[&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseArray</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;n&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseNull</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;t&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseTrue</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;f&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseFalse</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&quot;&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseString</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #6A737D">//如果不考虑出错的话，不是以上所有的情况即</span></span>
<span class=line><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseNumber</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parse</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">jsonstr</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 使用一个全局变量 i 来保存我们解析到哪里了，或者说下一步要从哪里开始解析</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  str </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> jsonStr</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseValue</span><span style="color: #C9D1D9">()</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 然后先实现一个解析出一个值的函数，名为 parseValue，同时，它解析完一个“值”后，会把 i 移动到下一个即将开始解析的位置，我们所有的函数都依赖这个变量i</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseValue</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;{&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseObject</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;[&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseArray</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;n&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseNull</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;t&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseTrue</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;f&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseFalse</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;&quot;&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseString</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #8B949E">//如果不考虑出错的话，不是以上所有的情况即</span></span>
<span class=line><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseNumber</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><p>接下来，我们只需要一步步实现 parseValue 函数所调用到的这几个函数就行了：</p><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseString</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&#39;</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span><span style="color: #24292E"> </span><span style="color: #6A737D">// 开始解析之前，i是指向双引号的，但字符的内容是不包含这个双引号的</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(str[i] </span><span style="color: #D73A49">!=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&quot;&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    result </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> str[i</span><span style="color: #D73A49">++</span><span style="color: #24292E">]</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span><span style="color: #6A737D">// 移动i到解析完成后的下一个位置</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseNull</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 简单粗暴，直接往后读出一个长度为4的个字符串出来</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 如果不是null，则直接报错</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> content </span><span style="color: #D73A49">=</span><span style="color: #24292E"> str.</span><span style="color: #6F42C1">substr</span><span style="color: #24292E">(i, </span><span style="color: #005CC5">4</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (content </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;null&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    i </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">null</span></span>
<span class=line><span style="color: #24292E">  } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;Unexpected char at pos: &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> i)</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseFalse</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 基本同上</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> content </span><span style="color: #D73A49">=</span><span style="color: #24292E"> str.</span><span style="color: #6F42C1">substr</span><span style="color: #24292E">(i, </span><span style="color: #005CC5">5</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (content </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;false&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    i </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">5</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span></span>
<span class=line><span style="color: #24292E">  } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;Unexpected char at pos: &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> i)</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseTrue</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 基本同上</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> content </span><span style="color: #D73A49">=</span><span style="color: #24292E"> str.</span><span style="color: #6F42C1">substr</span><span style="color: #24292E">(i, </span><span style="color: #005CC5">4</span><span style="color: #24292E">)</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (content </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;true&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    i </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> </span><span style="color: #005CC5">4</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class=line><span style="color: #24292E">  } </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">Error</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;Unexpected char at pos: &#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> i)</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseNumber</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 本函数的实现并没有考虑内容格式的问题，实际上JSON中的数值需要满足一个格式</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 不过好在这个格式基本可以用正则表达出来，不过这里就不写了</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 想写的话对着官网的铁路图写一个出来就行了</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 并且由于最后调用了parseFloat，所以如果格式不对，还是会报错的</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> numStr </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;&#39;</span><span style="color: #6A737D">//-2e+8</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 此处只要判断i位置还是数字字符，就继续读</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #6A737D">// 为了方便，写了另一个helper函数</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">isNumberChar</span><span style="color: #24292E">(str[i])) {</span></span>
<span class=line><span style="color: #24292E">    numStr </span><span style="color: #D73A49">+=</span><span style="color: #24292E"> str[i</span><span style="color: #D73A49">++</span><span style="color: #24292E">]</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">parseFloat</span><span style="color: #24292E">(numStr)</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// 判断字符c是否为组成JSON中数值的符号</span></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">isNumberChar</span><span style="color: #24292E">(</span><span style="color: #E36209">c</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> chars </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #032F62">&#39;-&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #032F62">&#39;+&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #032F62">&#39;e&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #032F62">&#39;E&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #032F62">&#39;.&#39;</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (chars[c]) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (c </span><span style="color: #D73A49">&gt;=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;0&#39;</span><span style="color: #24292E"> </span><span style="color: #D73A49">&amp;&amp;</span><span style="color: #24292E"> c </span><span style="color: #D73A49">&lt;=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;9&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// 解析数组，就很容易了</span></span>
<span class=line><span style="color: #6A737D">// 掐头去尾</span></span>
<span class=line><span style="color: #6A737D">// 然后一个值一个逗号</span></span>
<span class=line><span style="color: #6A737D">// 如果解析完一个值后没遇到逗号，说明解析完了</span></span>
<span class=line><span style="color: #6A737D">// 现在你知道没有多余的逗号有多好解析了吧~</span></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseArray</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> []</span><span style="color: #6A737D">//[1234,&quot;lsdf&quot;,true,false]</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(str[i] </span><span style="color: #D73A49">!==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;]&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    result.</span><span style="color: #6F42C1">push</span><span style="color: #24292E">(</span><span style="color: #6F42C1">parseValue</span><span style="color: #24292E">())</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;,&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span>
<span class=line><span style="color: #24292E">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A737D">// 解析对象，一如既往的简单</span></span>
<span class=line><span style="color: #6A737D">// 掐头去尾</span></span>
<span class=line><span style="color: #6A737D">// 然后一个key，是字符串</span></span>
<span class=line><span style="color: #6A737D">// 一个冒号</span></span>
<span class=line><span style="color: #6A737D">// 一个值，可能是任意类型，所以调用parseValue</span></span>
<span class=line><span style="color: #6A737D">// 最后，如果解析完一组k/v对，遇到了逗号，则解析下一组，没遇到逗号，则解析完毕</span></span>
<span class=line><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseObject</span><span style="color: #24292E">() {</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">var</span><span style="color: #24292E"> result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {}</span><span style="color: #6A737D">//{&quot;a&quot;:1,&quot;b&quot;:2}</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">while</span><span style="color: #24292E">(str[i] </span><span style="color: #D73A49">!==</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;}&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> key </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseString</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    i</span><span style="color: #D73A49">++</span><span style="color: #6A737D">//由于只考虑合法且无多余空白的JSON，所以这里就不判断是不是逗号了，正常应该是发现不是逗号就报错的</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> value </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">parseValue</span><span style="color: #24292E">()</span></span>
<span class=line><span style="color: #24292E">    result[key] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> value</span></span>
<span class=line><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (str[i] </span><span style="color: #D73A49">===</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;,&#39;</span><span style="color: #24292E">) {</span></span>
<span class=line><span style="color: #24292E">      i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">    }</span></span>
<span class=line><span style="color: #24292E">  }</span></span>
<span class=line><span style="color: #24292E">  i</span><span style="color: #D73A49">++</span></span>
<span class=line><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> result</span></span>
<span class=line><span style="color: #24292E">}</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseString</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> result </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;&#39;</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9"> </span><span style="color: #8B949E">// 开始解析之前，i是指向双引号的，但字符的内容是不包含这个双引号的</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">(str[i] </span><span style="color: #FF7B72">!=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;&quot;&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    result </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> str[i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">]</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span><span style="color: #8B949E">// 移动i到解析完成后的下一个位置</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> result</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseNull</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 简单粗暴，直接往后读出一个长度为4的个字符串出来</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 如果不是null，则直接报错</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> content </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> str.</span><span style="color: #D2A8FF">substr</span><span style="color: #C9D1D9">(i, </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (content </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;null&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    i </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span></span>
<span class=line><span style="color: #C9D1D9">  } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Error</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Unexpected char at pos: &#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> i)</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseFalse</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 基本同上</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> content </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> str.</span><span style="color: #D2A8FF">substr</span><span style="color: #C9D1D9">(i, </span><span style="color: #79C0FF">5</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (content </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;false&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    i </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">5</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span></span>
<span class=line><span style="color: #C9D1D9">  } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Error</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Unexpected char at pos: &#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> i)</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseTrue</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 基本同上</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> content </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> str.</span><span style="color: #D2A8FF">substr</span><span style="color: #C9D1D9">(i, </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">)</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (content </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;true&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    i </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class=line><span style="color: #C9D1D9">  } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Error</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Unexpected char at pos: &#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> i)</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseNumber</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 本函数的实现并没有考虑内容格式的问题，实际上JSON中的数值需要满足一个格式</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 不过好在这个格式基本可以用正则表达出来，不过这里就不写了</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 想写的话对着官网的铁路图写一个出来就行了</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 并且由于最后调用了parseFloat，所以如果格式不对，还是会报错的</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> numStr </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;&#39;</span><span style="color: #8B949E">//-2e+8</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 此处只要判断i位置还是数字字符，就继续读</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// 为了方便，写了另一个helper函数</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9"> (</span><span style="color: #D2A8FF">isNumberChar</span><span style="color: #C9D1D9">(str[i])) {</span></span>
<span class=line><span style="color: #C9D1D9">    numStr </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> str[i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">]</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">parseFloat</span><span style="color: #C9D1D9">(numStr)</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// 判断字符c是否为组成JSON中数值的符号</span></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">isNumberChar</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">c</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> chars </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;-&#39;</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;+&#39;</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;e&#39;</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;E&#39;</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">&#39;.&#39;</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (chars[c]) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (c </span><span style="color: #FF7B72">&gt;=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;0&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> c </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;9&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// 解析数组，就很容易了</span></span>
<span class=line><span style="color: #8B949E">// 掐头去尾</span></span>
<span class=line><span style="color: #8B949E">// 然后一个值一个逗号</span></span>
<span class=line><span style="color: #8B949E">// 如果解析完一个值后没遇到逗号，说明解析完了</span></span>
<span class=line><span style="color: #8B949E">// 现在你知道没有多余的逗号有多好解析了吧~</span></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseArray</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> result </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> []</span><span style="color: #8B949E">//[1234,&quot;lsdf&quot;,true,false]</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">(str[i] </span><span style="color: #FF7B72">!==</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;]&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    result.</span><span style="color: #D2A8FF">push</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">parseValue</span><span style="color: #C9D1D9">())</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;,&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> result</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span>
<span class=line></span>
<span class=line><span style="color: #8B949E">// 解析对象，一如既往的简单</span></span>
<span class=line><span style="color: #8B949E">// 掐头去尾</span></span>
<span class=line><span style="color: #8B949E">// 然后一个key，是字符串</span></span>
<span class=line><span style="color: #8B949E">// 一个冒号</span></span>
<span class=line><span style="color: #8B949E">// 一个值，可能是任意类型，所以调用parseValue</span></span>
<span class=line><span style="color: #8B949E">// 最后，如果解析完一组k/v对，遇到了逗号，则解析下一组，没遇到逗号，则解析完毕</span></span>
<span class=line><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseObject</span><span style="color: #C9D1D9">() {</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> result </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {}</span><span style="color: #8B949E">//{&quot;a&quot;:1,&quot;b&quot;:2}</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9">(str[i] </span><span style="color: #FF7B72">!==</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;}&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> key </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseString</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    i</span><span style="color: #FF7B72">++</span><span style="color: #8B949E">//由于只考虑合法且无多余空白的JSON，所以这里就不判断是不是逗号了，正常应该是发现不是逗号就报错的</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseValue</span><span style="color: #C9D1D9">()</span></span>
<span class=line><span style="color: #C9D1D9">    result[key] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value</span></span>
<span class=line><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (str[i] </span><span style="color: #FF7B72">===</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;,&#39;</span><span style="color: #C9D1D9">) {</span></span>
<span class=line><span style="color: #C9D1D9">      i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">    }</span></span>
<span class=line><span style="color: #C9D1D9">  }</span></span>
<span class=line><span style="color: #C9D1D9">  i</span><span style="color: #FF7B72">++</span></span>
<span class=line><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> result</span></span>
<span class=line><span style="color: #C9D1D9">}</span></span></code></pre></div>
</code></pre><p>最后打开 node 跑一次就可以看到最后的结果了:</p><pre><code class=language-js><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #24292E">{ </span><span style="color: #E36209">a</span><span style="color: #24292E">: </span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #E36209">b</span><span style="color: #24292E">: </span><span style="color: #005CC5">true</span><span style="color: #24292E">, </span><span style="color: #E36209">c</span><span style="color: #24292E">: </span><span style="color: #005CC5">false</span><span style="color: #24292E">, </span><span style="color: #E36209">foo</span><span style="color: #24292E">: </span><span style="color: #005CC5">null</span><span style="color: #24292E">, </span><span style="color: #E36209">bar</span><span style="color: #24292E">: [ </span><span style="color: #005CC5">1</span><span style="color: #24292E">, </span><span style="color: #005CC5">2</span><span style="color: #24292E">, </span><span style="color: #005CC5">3</span><span style="color: #24292E"> ] }</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #C9D1D9">{ </span><span style="color: #FFA657">a</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">b</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">c</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">foo</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">bar</span><span style="color: #C9D1D9">: [ </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9"> ] }</span></span></code></pre></div>
</code></pre><h3 id=ref>ref:</h3><ul><li><p><a href=http://www.ruanyifeng.com/blog/2009/05/data_types_and_json.html>http://www.ruanyifeng.com/blog/2009/05/data_types_and_json.html</a></p></li><li><p><a href=https://zhuanlan.zhihu.com/p/28049617>https://zhuanlan.zhihu.com/p/28049617</a></p></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>