<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=stylesheet href=/assets/fonts/font-awesome.min.css type=text/css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>移动端click事件的延迟处理 | https://zoubingwu.com</title><meta property=og:title content="移动端click事件的延迟处理 | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="移动端的click事件为了与double tap区分设定了一个300-350ms的延迟，这就使得绑定点击事件时带了了体验上的问题，本文从处理这种延迟开始简单描述了移动端自定义手势事件的原理。"><meta property=og:description content="移动端的click事件为了与double tap区分设定了一个300-350ms的延迟，这就使得绑定点击事件时带了了体验上的问题，本文从处理这种延迟开始简单描述了移动端自定义手势事件的原理。"><link rel=canonical href=https://zoubingwu.com/2017-07-23/移动端click事件的延迟处理><meta property=og:url content=https://zoubingwu.com/2017-07-23/移动端click事件的延迟处理><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-07-23T12:56:17.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="移动端click事件的延迟处理 | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>移动端click事件的延迟处理</div><span class=post-date><time>23 Jul 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>mobile</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>event</span></a></li></ul></div><h3 id=前言>前言</h3><blockquote><p>For many years, mobile browsers applied a 300-350ms delay between <code>touchend</code> and <code>click</code> while they waited to see if this was going to be a double-tap or not, since double-tap was a gesture to zoom into text.</p></blockquote><p>一直以来移动端在<code>touchend</code>和<code>click</code>事件的触发上都有着300到350ms的间隔，用以区分用户是否执行的是双击动作，这就使得如果使用点击事件会在移动端造成体验上的问题。</p><p>Google的文档对此也有介绍 — <a href=https://developers.google.com/web/updates/2013/12/300ms-tap-delay-gone-away>300ms tap delay gone away</a>，在2014年推出的chrome 32版本中引入一种移除此延迟的方式，即添加如下的<code>meta</code>标签：</p><pre><code class=language-html><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">meta</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;viewport&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">content</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;width=device-width&quot;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre>
</code></pre><p>不久之后IE/Edge/Firefox/iOS 9.3也都开始支持这一特性。</p><p>同时你也可以通过css来实现（原文提到火狐不支持，但2017年的今天是已经支持了的）：</p><pre><code class=language-css><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #E06C75">html</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  touch-action: </span><span style="color: #D19A66">manipulation</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span></code></pre>
</code></pre><h3 id=tap事件及引申>tap事件及引申</h3><p>其实 <a href=https://github.com/madrobby/zepto>zepto</a> 和 <a href=https://github.com/ftlabs/fastclick>fastclick</a> 这样的库已经提供了 tap 事件的实现，但是我们自己也可以尝试来实现一下。</p><p>zepto 提供的自定义的 tap 事件就是一个没有延迟的 click 事件，而 fastclick 是在<code>touchend</code> 之后生成一个 click 事件，并且立即触发它，再取消原本的 click 事件。这两者的原理都是在 <code>touchend</code> 之后触发，区别只在于触发的是原生的还是自定义的事件。</p><p>其中问题的关键在于，用户的手指接触到屏幕以后，可以是单击双击，也可以是滑动，因此不能够在每次的 <code>touchend</code> 事件之后都直接触发 tap。那么如何判定用户在点击还是滑动呢，zepto 是用的位移偏差，即记录下 <code>touchstart</code> 的时候的初始位移，然后用 <code>touchend</code> 的时候的位移减掉初始位移的偏差，如果这个差值在某一个固定值以内，则认为用户是点击，大于则认为是滑动。而 fastclick 是用的时间偏差，分别记录 <code>touchstart</code> 和 <code>touchend</code> 的时间戳，如果它们的时间差大于某一固定值，则认为是滑动操作，否则是点击操作。</p><p>同样的引申开来，如果要自己去做一个放大或者缩小的手势，我们也可以在 <code>touchstart</code> 里面获取 <code>event.touches</code> 两根手指的初始位置，保存初始化手指的距离，然后在 <code>touchmove</code> 里面再次获取新位置，计算新的距离减掉老的距离，如果是正数则说明是放大，反之缩小，放大和缩小的尺度也是可以取到一个相对值。</p></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>