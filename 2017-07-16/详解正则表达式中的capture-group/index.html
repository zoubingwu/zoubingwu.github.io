<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>详解正则表达式中的capture group | https://zoubingwu.com</title><meta property=og:title content="详解正则表达式中的capture group | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="说说如何利用正则表达式中的capture group来匹配重复项和进行特定的替换。"><meta property=og:description content="说说如何利用正则表达式中的capture group来匹配重复项和进行特定的替换。"><link rel=canonical href=https://zoubingwu.com/2017-07-16/详解正则表达式中的capture-group><meta property=og:url content=https://zoubingwu.com/2017-07-16/详解正则表达式中的capture-group><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2017-07-16T14:53:27.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="详解正则表达式中的capture group | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>详解正则表达式中的capture group</div><span class=post-date><time>16 Jul 2017</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>regular expression</span></a></li></ul></div><h2 id=前言>前言</h2><p>正则表达式这个东西属于熟能生巧，并没有什么特别难以理解的地方，这里推荐一个关于正则的<a href=http://regexr.com/ >网站</a>，提供了各种例子和cheatsheet，也可以很方便帮助理解开源项目源码中的各种正则。</p><p>这篇博文我们关于基本的正则匹配就不赘述了，主要说说其中的<code>capture group</code>。</p><h3 id=capture-group>capture group</h3><p>举个例子，我们需要检测一个字符串中是否有重复的字母：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #032F62">/(</span><span style="color: #005CC5">[a-zA-Z]</span><span style="color: #032F62">)</span><span style="color: #D73A49">\1</span><span style="color: #032F62">/</span><span style="color: #24292E">.</span><span style="color: #6F42C1">test</span><span style="color: #24292E">(str)</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #A5D6FF">/(</span><span style="color: #79C0FF">[a-zA-Z]</span><span style="color: #A5D6FF">)</span><span style="color: #FF7B72">\1</span><span style="color: #A5D6FF">/</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">test</span><span style="color: #C9D1D9">(str)</span></span></code></pre></div>
</code></pre><p>这利用括号包起来的一组，就是一个<code>capture group</code>，而之后的<code>\1</code>就是这第一个<code>capture group</code>的引用，如果有多组括号的话，后续的引用也就是<code>\2</code>,<code>\3</code>等。在<code>replace</code>等方法中，这个写法又稍微有区别了。</p><p>比如我们需要把一个http url替换为html中的a标签形式：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">var</span><span style="color: #24292E"> str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">&#39;you can click on https://google.com to visit google.com&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #24292E">str </span><span style="color: #D73A49">=</span><span style="color: #24292E"> str.</span><span style="color: #6F42C1">replace</span><span style="color: #24292E">(</span><span style="color: #032F62">/(https</span><span style="color: #D73A49">?</span><span style="color: #032F62">:</span><span style="color: #22863A; font-weight: bold">\/\/</span><span style="color: #005CC5">\S</span><span style="color: #D73A49">+?</span><span style="color: #032F62">)/</span><span style="color: #24292E">, </span><span style="color: #032F62">&#39;&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;&#39;</span><span style="color: #24292E">)</span></span>
<span class=line><span style="color: #6A737D">// you can click on &lt;a href=&quot;https://google.com&quot;&gt;https://google.com&lt;/a&gt; to visit google.com</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> str </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;you can click on https://google.com to visit google.com&#39;</span></span>
<span class=line></span>
<span class=line><span style="color: #C9D1D9">str </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> str.</span><span style="color: #D2A8FF">replace</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">/(https</span><span style="color: #FF7B72">?</span><span style="color: #A5D6FF">:</span><span style="color: #7EE787; font-weight: bold">\/\/</span><span style="color: #79C0FF">\S</span><span style="color: #FF7B72">+?</span><span style="color: #A5D6FF">)/</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class=line><span style="color: #8B949E">// you can click on &lt;a href=&quot;https://google.com&quot;&gt;https://google.com&lt;/a&gt; to visit google.com</span></span></code></pre></div>
</code></pre><p>在这里就是使用的$1， $2等来表示捕获组的引用，如果replace方法中的第二个参数是一个函数的话，它们也将作为第二个参数起传入该函数。</p><h3 id=non-capturing-group>non-capturing group</h3><p>那么有的时候我们单纯需要匹配一个已知的重复单词，而又不需要去记录它的引用呢？看看这个例子：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #032F62">/foo</span><span style="color: #D73A49">{3,}</span><span style="color: #032F62">/</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #A5D6FF">/foo</span><span style="color: #FF7B72">{3,}</span><span style="color: #A5D6FF">/</span></span></code></pre></div>
</code></pre><p>其实我们是想匹配重复三次以上的单词<code>foo</code>，但是又不需要去记录它的引用，而上面的正则中的3次以上只会去匹配字母o，这个时候我们也可以使用括号，但稍微有些不同：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #032F62">/(?:foo)</span><span style="color: #D73A49">{3,}</span><span style="color: #032F62">/</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #A5D6FF">/(?:foo)</span><span style="color: #FF7B72">{3,}</span><span style="color: #A5D6FF">/</span></span></code></pre></div>
</code></pre><h3 id=lookahead>lookahead</h3><p>括号还有两种用法，叫做<code>lookahead</code>，还是举例子，我们需要匹配字符串中的<code>president mao</code>或者是<code>president jiang</code>：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #032F62">/president</span><span style="color: #005CC5">\s</span><span style="color: #032F62">(?=jiang</span><span style="color: #D73A49">|</span><span style="color: #032F62">mao)/</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #A5D6FF">/president</span><span style="color: #79C0FF">\s</span><span style="color: #A5D6FF">(?=jiang</span><span style="color: #FF7B72">|</span><span style="color: #A5D6FF">mao)/</span></span></code></pre></div>
</code></pre><p><code>x(?=y)</code> 这种形式就是仅仅匹配x后面跟着y，这叫做positive lookahead，对于仅匹配x后面不跟着y的，它的形式就是 <code>x(?!y)</code> 这样的(negative lookahead)。</p><h3 id=named-capture-groupsproposal>Named Capture Groups(proposal)</h3><p>之前说的匹配组有一个问题是，只能用数字来作为序号引用，每一组的匹配含义也不容易看出来。因此有了<a href=https://github.com/tc39/proposal-regexp-named-groups>具名匹配组</a>这样一个提案，可以为每一组指定一个具体的名字，这样便于阅读和引用。</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">RE_DATE</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #032F62"> /(?&lt;</span><span style="color: #24292E">year</span><span style="color: #032F62">&gt;</span><span style="color: #005CC5">\d</span><span style="color: #D73A49">{4}</span><span style="color: #032F62">)-(?&lt;</span><span style="color: #24292E">month</span><span style="color: #032F62">&gt;</span><span style="color: #005CC5">\d</span><span style="color: #D73A49">{2}</span><span style="color: #032F62">)-(?&lt;</span><span style="color: #24292E">day</span><span style="color: #032F62">&gt;</span><span style="color: #005CC5">\d</span><span style="color: #D73A49">{2}</span><span style="color: #032F62">)/</span><span style="color: #24292E">;</span></span>
<span class=line></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">matchObj</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">RE_DATE</span><span style="color: #24292E">.</span><span style="color: #6F42C1">exec</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;1999-12-31&#39;</span><span style="color: #24292E">);</span></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">year</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> matchObj.groups.year; </span><span style="color: #6A737D">// 1999</span></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">month</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> matchObj.groups.month; </span><span style="color: #6A737D">// 12</span></span>
<span class=line><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">day</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> matchObj.groups.day; </span><span style="color: #6A737D">// 31</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RE_DATE</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #A5D6FF"> /(?&lt;</span><span style="color: #C9D1D9">year</span><span style="color: #A5D6FF">&gt;</span><span style="color: #79C0FF">\d</span><span style="color: #FF7B72">{4}</span><span style="color: #A5D6FF">)-(?&lt;</span><span style="color: #C9D1D9">month</span><span style="color: #A5D6FF">&gt;</span><span style="color: #79C0FF">\d</span><span style="color: #FF7B72">{2}</span><span style="color: #A5D6FF">)-(?&lt;</span><span style="color: #C9D1D9">day</span><span style="color: #A5D6FF">&gt;</span><span style="color: #79C0FF">\d</span><span style="color: #FF7B72">{2}</span><span style="color: #A5D6FF">)/</span><span style="color: #C9D1D9">;</span></span>
<span class=line></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">matchObj</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RE_DATE</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">exec</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;1999-12-31&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">year</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> matchObj.groups.year; </span><span style="color: #8B949E">// 1999</span></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">month</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> matchObj.groups.month; </span><span style="color: #8B949E">// 12</span></span>
<span class=line><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">day</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> matchObj.groups.day; </span><span style="color: #8B949E">// 31</span></span></code></pre></div>
</code></pre><p>可以看到，使用 <code>?&lt;xxx&gt;</code> 这样的形式可以为一个组确定一个组名，并在返回对象的groups属性使用组名来引用。</p><h3 id=lookbehindproposal>lookbehind(proposal)</h3><p>同样的，由于 <code>lookahead</code> 只能根据后半部分来匹配，因此有了与其相反的一个<a href=https://github.com/goyakin/es-regexp-lookbehind>提案</a>，可以根据前面部分的内容来匹配。</p><p>比如，只匹配美元符号之后的数字，可以写成 <code>/(?&lt;=\$)\d+/</code>，只匹配不在美元符号之后的数字，可以写成 <code>/(?&lt;!\$)\d+/</code>：</p><pre><code class=language-javascript><div class=shiki-light><pre class=shiki style="background-color: #ffffff"><code><span class=line><span style="color: #032F62">/(?&lt;=</span><span style="color: #22863A; font-weight: bold">\$</span><span style="color: #032F62">)</span><span style="color: #005CC5">\d</span><span style="color: #D73A49">+</span><span style="color: #032F62">/</span><span style="color: #24292E">.</span><span style="color: #6F42C1">exec</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;Benjamin Franklin is on the $100 bill&#39;</span><span style="color: #24292E">)  </span><span style="color: #6A737D">// [&quot;100&quot;]</span></span>
<span class=line><span style="color: #032F62">/(?&lt;!</span><span style="color: #22863A; font-weight: bold">\$</span><span style="color: #032F62">)</span><span style="color: #005CC5">\d</span><span style="color: #D73A49">+</span><span style="color: #032F62">/</span><span style="color: #24292E">.</span><span style="color: #6F42C1">exec</span><span style="color: #24292E">(</span><span style="color: #032F62">&#39;it’s is worth about €90&#39;</span><span style="color: #24292E">)                </span><span style="color: #6A737D">// [&quot;90&quot;]</span></span></code></pre></div><div class=shiki-dark><pre class=shiki style="background-color: #0d1117"><code><span class=line><span style="color: #A5D6FF">/(?&lt;=</span><span style="color: #7EE787; font-weight: bold">\$</span><span style="color: #A5D6FF">)</span><span style="color: #79C0FF">\d</span><span style="color: #FF7B72">+</span><span style="color: #A5D6FF">/</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">exec</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Benjamin Franklin is on the $100 bill&#39;</span><span style="color: #C9D1D9">)  </span><span style="color: #8B949E">// [&quot;100&quot;]</span></span>
<span class=line><span style="color: #A5D6FF">/(?&lt;!</span><span style="color: #7EE787; font-weight: bold">\$</span><span style="color: #A5D6FF">)</span><span style="color: #79C0FF">\d</span><span style="color: #FF7B72">+</span><span style="color: #A5D6FF">/</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">exec</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;it’s is worth about €90&#39;</span><span style="color: #C9D1D9">)                </span><span style="color: #8B949E">// [&quot;90&quot;]</span></span></code></pre></div>
</code></pre><h3 id=总结>总结</h3><p>熟练使用<code>capture group</code>和<code>lookahead</code>在一些字符串的替换和查找中是非常方便的，当然本文对此的介绍也是比较简单的，只有经常练习和使用才能更好的掌握这些用法。</p><h4 id=ref>ref</h4><ul><li><a href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions>https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions</a></li><li><a href=http://regexr.com/ >http://regexr.com/</a></li><li><a href=http://es6.ruanyifeng.com/#docs/regex>http://es6.ruanyifeng.com</a></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>