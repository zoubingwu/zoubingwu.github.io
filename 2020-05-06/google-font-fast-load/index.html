<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css as=style><link rel=preload href=/assets/fonts/font-awesome.min.css as=style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.6.0/style.css><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>google font fast load | https://zoubingwu.com</title><meta property=og:title content="google font fast load | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="解决 google font 在国内加载速度的问题"><meta property=og:description content="解决 google font 在国内加载速度的问题"><link rel=canonical href=https://zoubingwu.com/2020-05-06/google-font-fast-load><meta property=og:url content=https://zoubingwu.com/2020-05-06/google-font-fast-load><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2020-05-06T18:28:44.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="google font fast load | https://zoubingwu.com"><script defer=defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "76b8468271b24f3180af2110f74841c3"}'></script></head><body><main class=content-container><div class=post><div class=post-title>google font fast load</div><span class=post-date><time>6 May 2020</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>browser</span></a></li><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>performance</span></a></li></ul></div><p>最近换了个更舒服的中文字体，但由于众所周知的原因，google font 的加载速度在国内一直比较慢，博客里直接引用相关的资源可能导致加载速度不理想。随手搜了一下相关镜像发现都是好几年的了，有些也不再维护了。</p><p>其实对于 Github 开源的博客来说有很多相关的工具可以直接使用，思路非常简单：字体相关资源直接保存到 Github repo，通过 jsdelivr CDN 服务来访问相关资源。</p><p>jsdelivr 可以通过构造下面这样的路径来访问 Github 仓库的资源，而且在国内的速度还不错：<code>https://cdn.jsdelivr.net/gh/&lt;用户名&gt;/&lt;仓库名&gt;@&lt;分支名&gt;/&lt;文件路径&gt;</code>，另外对于图片之类的资源也可以使用这种方式。</p><p>由于 google font 是通过一个 css 去引用其他的 gstatic 域名上的相关字体文件，可能涉及到非常多的文件和路径的替换，这里可以直接使用一个 <a href=https://www.npmjs.com/package/get-google-fonts>get-google-fonts</a> 的包来完成下载和引用路径的替换：</p><pre><code class=language-sh><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #ABB2BF">npx get-google-fonts -i https://fonts.googleapis.com/css</span><span style="color: #56B6C2">\?</span><span style="color: #ABB2BF">family</span><span style="color: #56B6C2">\=</span><span style="color: #ABB2BF">Noto+Serif+SC</span><span style="color: #56B6C2">\&amp;</span><span style="color: #ABB2BF">display</span><span style="color: #56B6C2">\=</span><span style="color: #ABB2BF">swap -p https://cdn.jsdelivr.net/gh/shadeofgod/shadeofgod.github.io@master/fonts/ -c googlefont.css</span></span></code></pre>
</code></pre><p>然后把相关引用的资源替换成 <code>https://cdn.jsdelivr.net/gh/shadeofgod/shadeofgod.github.io@master/fonts/googlefont.css</code> 就可以了</p><p>另外字体文件通常比较大，有些浏览器下载完成之前可能会先隐藏文字的显示，这样会导致 <a href=https://web.dev/avoid-invisible-text>a flash of invisible text (FOIT)</a>。可以通过设置 <code>font-display: swap</code> 来先显示默认字体，完成下载后再替换，实际上 google font 本身就提供了这种设置，直接在 google font URL 的末尾添加一个 <code>&amp;display=swap</code> 的参数就可以了。</p><h3 id=reference>reference</h3><ul><li><a href=https://www.jsdelivr.com/features>https://www.jsdelivr.com/features</a></li><li><a href=https://www.npmjs.com/package/get-google-fonts>https://www.npmjs.com/package/get-google-fonts</a></li><li><a href=https://web.dev/font-display/ >https://web.dev/font-display/</a></li><li><a href=https://web.dev/avoid-invisible-text>https://web.dev/avoid-invisible-text</a></li></ul></div><div class=footer><hr><div class=footer-link><a href=/archive aria-label="Read more about all archives"><i class="fa fa-archive" aria-hidden=true></i> </a><a target=_blank href=https://twitter.com/chow_won aria-label="Read more on twitter"><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu aria-label="Read more on github"><i class="fa fa-github" aria-hidden=true></i> </a><a target=_blank href=mailto:zoubingwu@gmail.com aria-label=Email><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2023 zoubingwu. All rights reserved.</div></main></body></html>