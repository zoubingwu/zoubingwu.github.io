<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=keywords content=blog,html,css,javascript,react,vue,nodejs><meta name=description content="zoubingwu 个人博客, zoubingwu's blog"><link href=/assets/images/favicon.ico rel=bookmark type=image/x-icon><link href=/assets/images/favicon.ico rel=icon type=image/x-icon><link href=/assets/images/favicon.ico rel="shortcut icon" type=image/x-icon><link rel=stylesheet href=/assets/css/main.css type=text/css><link rel=preload href=/assets/fonts/googlefont.css as=style><link rel=preload href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=stylesheet href=/assets/fonts/googlefont.css as=style><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css as=style><link rel=alternate type=application/rss+xml title="RSS Feed for zoubingwu's blog" href=/feed.xml><title>Understanding infer in TypeScript | https://zoubingwu.com</title><meta property=og:title content="Understanding infer in TypeScript | https://zoubingwu.com"><meta property=og:locale content=en_US><meta name=description content="Usage of infer keyword in TypeScript."><meta property=og:description content="Usage of infer keyword in TypeScript."><link rel=canonical href=https://zoubingwu.com/2022-05-12/understanding-infer-in-typescript><meta property=og:url content=https://zoubingwu.com/2022-05-12/understanding-infer-in-typescript><meta property=og:site_name content="zoubingwu's blog"><meta property=og:type content=article><meta property=article:published_time content=2022-05-12T23:00:33.000Z><meta name=twitter:card content=summary><meta property=twitter:title content="Understanding infer in TypeScript | https://zoubingwu.com"><script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r]
  || function () { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 *
  new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
  a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document,
  'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
  ga('create', 'UA-100363260-1', 'auto'); ga('send', 'pageview');</script></head><body><div class=content-container><div class=post><div class=post-title>Understanding infer in TypeScript</div><span class=post-date><time>12 May 2022</time></span><div class=post-tag><ul><li><a><span><i class="fa fa-paperclip" aria-hidden=true></i>ts</span></a></li></ul></div><p>TypeScript 中的 <code>infer</code> 关键字在一般的应用的开发上可能用的不多，而且本身内置的类型里很多都是通过它来实现的，在写一些库的时候，也很可能会需要用到。它主要是起到一个类似 placeholder 的作用，让我们可以获取到那个位置的类型的值，需要注意的是它只能在<strong>条件类型</strong>的语句中使用。</p><p>条件类型有点像 js 里的三元运算符，<code>(condition ? trueExpression : falseExpression)</code>，只是作用于类型之上：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">SomeType</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">OtherType</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">TrueType</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FalseType</span><span style="color: #ABB2BF">;</span></span></code></pre>
</code></pre><p>这里的 <code>extends</code> 关键字，声明了一种类型约束，它和 <code>interface A extends B</code> 或者 <code>class A extends B</code> 中的这种表示继承动作的语义很明显是有区别的，但他们确实又有一定的联系，在条件类型中，<code>T extends K</code> 意味着我们是否可以安全的认为 <code>T</code> 的类型是 <code>K</code> 的子类型。</p><p>例如，配合 <code>never</code> 类型，我们可以用这种约束关系来缩小类型的范围：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NullableString</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">null</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">undefined</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NonNullable</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">null</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">undefined</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">// Built-in type, FYI</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NonNullableString</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">NonNullable</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">NullableString</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">// evalutes to `string`</span></span></code></pre>
</code></pre><p>或者提取出其中一部分类型：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Extract</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Exclude</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;a&#39;</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">&#39;b&#39;</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">&#39;c&#39;</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Extract</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;a&#39;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BC</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Exclude</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;a&#39;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre>
</code></pre><p>对于一个数组类型，可以获取到数组的 item 的类型：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// `T[number]` 这里用了一个 `Indexed Access Types` 的技巧，来获取到数组的 item 的类型。</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Flatten</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">[] </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Str</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Flatten</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[]&gt;; </span><span style="color: #7F848E; font-style: italic">// string</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Num</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Flatten</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// number</span></span></code></pre>
</code></pre><p>简单说一下什么是 <code>Indexed Access Types</code> 呢，就是直接像访问对象属性一样使用类型，来获取它的某个属性的类型：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">age</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">; </span><span style="color: #E06C75">alive</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF"> };</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Age</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&quot;age&quot;</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// number</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// 还可以使用 Union</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">I1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&quot;age&quot;</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// number | string</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// 或者利用 keyof</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">I2</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">[</span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// &quot;age&quot; | &quot;name&quot; | &quot;alive&quot;</span></span>
<span class=line></span>
<span class=line><span style="color: #7F848E; font-style: italic">// 或者其他类型</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AliveOrName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;alive&quot;</span><span style="color: #ABB2BF"> | </span><span style="color: #98C379">&quot;name&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">I3</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">AliveOrName</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// &quot;alive&quot; | &quot;name&quot;</span></span></code></pre>
</code></pre><p>再回到我们的条件类型，<strong>先将类型约束到一个具体的类型，然后从中提取出来我们需要部分的类型</strong>，这是一个可以借助条件类型来实现的非常常见的场景，但有的时候可能不存在像上面那样能利用 <code>Indexed Access Types</code> 来访问到我们需要的部分的情况，例如获取到函数的参数或者返回类型，为此 ts 提供了一个 <code>infer</code> 关键字，有一点像解构赋值一样，我们在需要的部分前加上 <code>infer</code> 关键字，就能获取到我们需要的部分类型了将它保存起来使用了：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Flatten</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Array</span><span style="color: #ABB2BF">&lt;infer </span><span style="color: #E5C07B">Item</span><span style="color: #ABB2BF">&gt; </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">;</span></span></code></pre>
</code></pre><p>通过 <code>infer</code> 我们声明了一个新的 <code>Item</code> 的泛型，来获取数组的 Item 的类型，就好像我们通过解构赋值来获取数组的 Item 一样。这里有两个需要注意点的事项：</p><ul><li><strong><code>infer</code> 只能在 Conditional Types 中使用，不能在其他地方使用。</strong></li><li><strong><code>infer</code> 获取的类型只能使用在 True 分支上</strong></li></ul><p>例如我们可以用来解决提到的获取函数的返回类型，一个函数的类型一般是这样的，<code>(...args: any[]) =&gt; any</code>，那么可以有：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ReturnType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> (...</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">[]) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> infer </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">number</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ReturnType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">add</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// number</span></span></code></pre>
</code></pre><p>那么获取函数的参数的类型也很简单了：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParamsType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> (...</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">B</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ParamsType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">add</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// [number, number]</span></span></code></pre>
</code></pre><p>也可以获取函数的第一个参数的类型：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FirstParamsType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">a</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF">, ...</span><span style="color: #E06C75; font-style: italic">args</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">C</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FirstParamsType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">add</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// number</span></span></code></pre>
</code></pre><p>对于多个类型签名的，例如重载过的函数，目前 ts 只支持 <code>infer</code> 使用最后一个类型来进行推断：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stringOrNum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stringOrNum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">stringOrNum</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">ReturnType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">stringOrNum</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// string | number</span></span></code></pre>
</code></pre><p>当然除了函数，<code>infer</code> 还可以用在任何对象中，比如：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">User</span><span style="color: #ABB2BF"> {</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">  </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class=line><span style="color: #ABB2BF">}</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PropertyType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PropertyType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">User</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">// [number, string]</span></span></code></pre>
</code></pre><p>上面我们声明了 U 和 R 两个泛型，最后组合成一个 tuple，那么如果只声明一个泛型，ts 会怎么推断呢？</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PropertyType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">P</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PropertyType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">User</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">// number | string</span></span></code></pre>
</code></pre><p>在协变位置上，它会返回一个 Union Type。而在逆变位置上，若同一个类型变量存在多个候选者，则最终的类型将被推断为 Intersection Type。</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bar</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> { </span><span style="color: #61AFEF">a</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">b</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class=line></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Bar</span><span style="color: #ABB2BF">&lt;{ </span><span style="color: #61AFEF">a</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">b</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">x</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> }&gt;;  </span><span style="color: #7F848E; font-style: italic">// string &amp; number =&gt; never</span></span></code></pre>
</code></pre><p>发现了吗，结合利用函数参数类型的逆变性，我们可以通过 Union Type 来转换成 Intersection Type 了！例如我们希望把很多个对象给拼到一起构成一个类型，可以这样：</p><pre><code class=language-ts><pre class=shiki style="background-color: #282c34"><code><span class=line><span style="color: #7F848E; font-style: italic">// 先转换成一个函数放到参数里，然后求交集</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">UnionToIntersection</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">arg</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">U</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">arg</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> }</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">B</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF"> }</span></span>
<span class=line><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">UnionToIntersection</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">A</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">B</span><span style="color: #ABB2BF">&gt; </span><span style="color: #7F848E; font-style: italic">// {a: string; b: number}</span></span></code></pre>
</code></pre></div><div class=footer><hr><div class=footer-link><a href=/archive><i class="fa fa-archive" aria-hidden=true></i></a><a target=_blank href=https://twitter.com/chow_won><i class="fa fa-twitter" aria-hidden=true></i></a> <a target=_blank href=https://github.com/zoubingwu><i class="fa fa-github" aria-hidden=true></i></a> <a target=_blank href=mailto:zoubingwu@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div>© 2016-2021 zoubingwu. All rights reserved.</div></div></body></html>